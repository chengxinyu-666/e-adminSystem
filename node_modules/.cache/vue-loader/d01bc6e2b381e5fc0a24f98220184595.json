{"remainingRequest":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workCode\\xiaoE\\大圣系统源码\\admin\\src\\components\\order\\dialog_order_return.vue?vue&type=style&index=0&id=4ff6f592&scoped=true&lang=css&","dependencies":[{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\src\\components\\order\\dialog_order_return.vue","mtime":1676968324000},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\css-loader\\index.js","mtime":1678778409149},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1678778410194},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1678778410012},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678778409044},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1678778410194}],"contextDependencies":[],"result":["\n.bottom{\n  padding-bottom: 0px !important;\n  margin-bottom: 0px !important;\n}\n:deep .avue-crud__menu {\n  display: none;\n}\n:deep .el-empty {\n  padding: 0px 0px !important;\n}\n:deep .avue-crud__empty {\n  padding: 0px 0px !important;\n}\n:deep .el-empty__image {\n  display: none;\n}\n:deep .el-table--small .el-table__cell {\n    padding: 0px 0px !important;\n}\n",{"version":3,"sources":["dialog_order_return.vue"],"names":[],"mappings":";AA0rBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"dialog_order_return.vue","sourceRoot":"src/components/order","sourcesContent":["<!--\n 订单修改\n -->\n<template>\n  <div>\n    <el-dialog\n      v-if=\"isShow\"\n      title=\"归还结算\"\n      :visible.sync=\"isShow\"\n      width=\"900px\"\n      @close=\"closeFn\"\n      append-to-body\n      style=\"text-align: left\">\n      <el-form ref=\"form1\" label-width=\"120px\" size=\"small\">\n        <div>\n          订单基本信息\n        </div>\n        <div style=\"border-radius: 5px;padding: 0px 5px;border: 1px solid #eeeeee;padding-top: 10px;padding-bottom: 10px;margin-top: 10px\">\n          <el-row>\n            <el-col :span=\"12\" style=\"display: flex;flex-direction: column\">\n              <el-form-item label=\"订单编号：\" class=\"bottom\">\n                <div style=\"display: flex\">\n                  <span >{{param.no}}</span>\n                  <span style=\"flex: 1\"></span>\n                </div>\n              </el-form-item>\n              <el-form-item label=\"租赁方案：\" class=\"bottom\">\n                  {{getPackageName(param.goodsCombinationJson)}}\n              </el-form-item>\n              <el-form-item label=\"押金：\" class=\"bottom\">\n                  {{param.amount}}({{param.freeType == 1?\"芝麻免押\":(param.freeType == 2?\"支付宝押金\":\"其他\")}})\n              </el-form-item>\n              <el-form-item label=\"商品官网价：\" class=\"bottom\">\n                  {{ param.websitePrice }}\n              </el-form-item>\n              <el-form-item label=\"每期租金：\" class=\"bottom\">\n                  {{ param.rentPerMoney }}(第一期{{param.rentFirstMoney}})(总租金{{ param.rentMoney }})\n              </el-form-item>\n            </el-col>\n            <el-col :span=\"12\">\n              <el-form-item label=\"租赁商品：\" class=\"bottom\">\n                <div style=\"display: flex\">\n                  <span >{{ param.goodsTitle }}</span>\n                  <span style=\"color: #169BD5\" @click=\"goodsInfo\">点击查看商品详情</span>\n                  <span style=\"flex: 1\"></span>\n                </div>\n              </el-form-item>\n              <el-form-item label=\"租期：\" class=\"bottom\">\n                  {{param.lease}}个{{ getLeaseTypeTitle(param.leaseType) }}\n              </el-form-item>\n              <el-form-item label=\"二次押金：\" class=\"bottom\">\n                  {{ getSecondDeposit() }}\n              </el-form-item>\n              <el-form-item label=\"买断价：\" class=\"bottom\">\n                 当前买断价{{getNowBuyoutMoney()}}(总买断价：{{getBuyoutPrice(param.goodsCombinationJson)}})\n              </el-form-item>\n              <el-form-item label=\"买断尾款：\" class=\"bottom\">\n                  {{getBuyoutBalancePayment() }}\n              </el-form-item>\n            </el-col>\n          </el-row>\n        </div>\n        <div style=\"margin-top: 20px\">\n          损坏情况\n        </div>\n        <avue-crud  :key=\"table_key\" ref=\"crud\" :option=\"destroyInfo\" :data=\"destroy\" style=\"margin-top: 10px\">\n          <template #menu=\"{row,index,size}\">\n            <div style=\"display: flex\">\n              <el-button type=\"text\" icon=\"el-icon-view\"  @click=\"viewImage(row)\">查看附件</el-button>\n            </div>\n          </template>\n        </avue-crud>\n        <div style=\"text-align: center;margin-top: 10px\"><el-button icon=\"el-icon-plus\" @click=\"dialogFormVisible = true\">{{destoryBill.money>0?\"编辑损坏账单\":\"添加损坏账单\"}}</el-button></div>\n        <div style=\"margin-top: 20px\">\n          订单支付记录\n        </div>\n        <avue-crud  :key=\"table_key\" ref=\"crud\" :option=\"option\" :data=\"orderBills\" style=\"margin-top: 10px\">\n          <template #menu=\"{row,index,size}\">\n            <div style=\"display: flex\">\n              <el-checkbox v-model=\"row.hasPay\" v-if=\"row.cancel\">需要支付</el-checkbox>\n            </div>\n          </template>\n          <template slot=\"typeName\" slot-scope=\"scope\">\n            <span>{{ getOrderNperNumber(scope) }}</span>\n          </template>\n          <template slot=\"due\" slot-scope=\"scope\">\n            <span>{{ getDue(scope.row) }}</span>\n          </template>\n          <template slot=\"factPayMoney\" slot-scope=\"scope\">\n              <span v-if=\"scope.row.factPayMoney\">\n                  实付({{scope.row.factPayMoney}})\n              </span>\n              <span v-if=\"scope.row.reductionMoney\">\n                  减免({{scope.row.reductionMoney}})\n              </span>\n              <span v-if=\"scope.row.couponMoney\">\n                  优惠({{scope.row.couponMoney}})\n              </span>\n              <span v-if=\"scope.row.depositMoney\">\n                  押金抵消({{scope.row.depositMoney}})\n              </span>\n              <span v-if=\"(Number.parseFloat(scope.row.factPayMoney)+Number.parseFloat(scope.row.reductionMoney)+Number.parseFloat(scope.row.couponMoney)+Number.parseFloat(scope.row.depositMoney)) === 0\">0</span>\n          </template>\n          <template slot=\"allOverdueMoney\" slot-scope=\"scope\">\n              <div v-if=\"scope.row.allOverdueMoney && Number.parseFloat(scope.row.allOverdueMoney)>0\">{{ scope.row.allOverdueMoney }}\n                  <span>{{scope.row.noPayOverdueMoney == 0?\"(已结清)\":(\"（欠款\"+scope.row.noPayOverdueMoney+\"）\")}}</span>\n              </div>\n              <div v-else>0</div>\n          </template>\n        </avue-crud>\n        <div style=\"margin-top: 5px\">\n          总减免：{{reduction}}\n        </div>\n        <div style=\"margin-top: 0px\">\n          已付款：{{paid}}\n        </div>\n        <div style=\"margin-top: 0px\">\n          总押金：{{firstDeposit>0?firstDeposit:allDeposit}}\n        </div>\n        <div style=\"margin-top: 0px\">\n          剩余押金：{{leaveDeposit}}\n        </div>\n        <div style=\"margin-top: 0px\">\n          欠款：{{allDue==0?0:-1*allDue}}\n        </div>\n        <div style=\"margin-top: 0px\" v-if=\"depositType == 2\">\n          汇总：{{totleMoney}}\n        </div>\n        <div style=\"margin-top: 20px\">\n          客户结算方式（客户选择：<span style=\"color: blue\">归还商品</span>，<span style=\"color: red\">{{depositType ==2?\"押金抵消\":\"退还押金\"}}</span>）\n        </div>\n        <div style=\"margin-top: 10px\" v-if=\"depositType==2\">\n          <span v-if=\"hasPay<0\">需支付金额：<span style=\"color: red;font-size: 20px\">{{ Math.abs(hasPay)}}</span></span>\n          <span v-if=\"hasPay>0\">需退回金额：<span style=\"color: red;font-size: 20px\">{{ Math.abs(hasPay)}}</span></span>\n        </div>\n        <div style=\"margin-top: 10px\" v-else>\n          <span v-if=\"allDue>=0\">需支付：<span style=\"color: red;font-size: 20px\">{{ Math.abs(allDue)}}</span></span>\n          <span v-if=\"leaveDeposit>=0\" style=\"margin-left: 10px;\">需退回押金：<span style=\"color: red;font-size: 20px\">{{ leaveDeposit}}</span></span>\n        </div>\n\n      </el-form>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"isShow = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"isOfflineShow = true\" v-if=\"param.status == 8\">线下结算</el-button>\n           <el-button type=\"primary\" @click=\"onlineShow = true\" v-if=\"param.status == 8\">生成在线结算订单</el-button>\n      </span>\n    </el-dialog>\n    <el-dialog title=\"赔偿账单\" :visible.sync=\"dialogFormVisible\"  style=\"z-index: 9999 !important;\">\n      <el-form ref=\"billForm\" :model=\"destoryBill\">\n        <el-form-item label=\"赔偿金额\" :label-width=\"140\" prop=\"money\"  :rules=\"[ { required: true, message: '金额不能为空'}]\">\n          <el-input v-model=\"destoryBill.money\" autocomplete=\"off\"></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"addBill\">确 定</el-button>\n      </div>\n    </el-dialog>\n    <el-dialog\n      v-if=\"isOfflineShow\"\n      v-model=\"form\"\n      title=\"线下结算\"\n      :visible.sync=\"isOfflineShow\"\n      width=\"600px\"\n      @close=\"closeFn\"\n      append-to-body\n      style=\"text-align: left\">\n      <avue-form ref=\"form\" class=\"bill_info\" v-model=\"offlineForm\" :option=\"offline\" @submit=\"submit\" @reset-change=\"cancle\">\n        <template slot-scope=\"{size}\" slot=\"menuForm\">\n          <div slot=\"footer\" class=\"dialog-footer\" style=\"text-align: end;\">\n            <el-button size=\"medium\" @click=\"isOfflineShow = false\">取 消</el-button>\n            <el-button size=\"medium\" type=\"primary\"  @click=\"submit(1)\">确 定</el-button>\n          </div>\n        </template>\n      </avue-form>\n    </el-dialog>\n    <el-dialog title=\"线上结算\" :visible.sync=\"onlineShow\"  style=\"z-index: 9999 !important;\">\n      <div>\n        <div v-if=\"offlineForm.payMoney>0\" style=\"padding-bottom: 10px\">结算需支付金额：<span style=\"color: red;font-size: 20px\">{{offlineForm.payMoney}}</span></div>\n        <div v-if=\"offlineForm.returnMoney>0\">结算退还金额：<span style=\"color: red;font-size: 20px\">{{offlineForm.returnMoney}}</span>(在订单支付成功后原路退回)</div>\n      </div>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"onlineShow = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submit(2)\">确 定</el-button>\n      </div>\n    </el-dialog>\n    <el-image-viewer\n      class=\"imageview\"\n      v-if=\"showViewer2\"\n      style=\"z-index:9999 !important;\"\n      :on-close=\"() => {showViewer2 = false;}\"\n      :url-list=\"imageslist\">\n    </el-image-viewer>\n  </div>\n</template>\n<script>\n\n  import {headers} from \"../../util/auth\";\n  import {\n    leaseTypeTitle,\n    buyoutBalancePayment,\n    buyoutPrice,\n    packageName,\n    secondDeposit, indexNumber\n  } from \"../../util/order\";\n  import {calculateMoneyStats, floatObj, toFixed} from \"../../constant/goods/constant\";\n  import moment from \"moment\";\n  import vue from \"../../main\";\n  import {changeBt, settlement} from \"../../api/order/order\";\n  import ElImageViewer from \"element-ui/packages/image/src/image-viewer\";\n\n  export default {\n    name: 'dialog',\n    components: {\n      ElImageViewer,\n    },\n    data () {\n      return {\n        param:null,\n        order:null,\n        destroy:null,\n        isShow:false,\n        showViewer2:false,\n        imageUrl: '',\n        dialogFormVisible:false,\n        imageslist:[],\n        onlineShow:false,\n        table_key:0,\n        textarea:'',\n        depositType:null,\n        destoryBill: {\n          money:0,\n          type: 8,\n          factPayMoney : 0,\n          reductionMoney: 0,\n          couponMoney : 0,\n          hasPay:true,\n          cancel:true,\n           depositMoney : 0,\n          typeName :\"损坏赔偿\",\n           startTime: moment().format('YYYY-MM-DD'),\n        },\n        offlineForm: {payMoney:0,returnMoney:0},\n        isOfflineShow:false,\n        offline:{\n          submitBtn:false,\n          emptyBtn:false,\n          labelWidth: 160,\n          column: [{\n              label:'结算需支付金额',\n              prop:'payMoney',\n              span: 24,\n              type:'title',\n            },{\n              label:'结算退还金额',\n              prop:'returnMoney',\n              span: 24,\n              type:'title',\n            },{\n              label:'上传线下凭证',\n              prop:'images',\n              type: 'upload',\n              span: 24,\n              listType: 'picture-card',\n              tip: '只能上传jpg/png文件，且不超过500kb',\n              propsHttp: {\n                home: vue.$store.state.common.cloudDomain,\n                res: \"data\",\n                url: 'name',\n                name: 'originalName'\n              },\n              action: '/api/blade-resource/oss/endpoint/put-file',\n              rules: [{\n                required: true,\n                message: \"请上传发货图片\",\n                trigger: \"blur\"\n              }]\n            },\n          ]\n        },\n        destroyLists:[],\n        orderBills:[],\n        allDue:0,//总欠款\n        allRent : 0,//总租金\n        reduction : 0,//减免\n        allDeposit : 0,//总押金\n        paid : 0,//已付\n        leaveDeposit:0,//剩余押金\n        totleMoney:0,//汇总\n        firstDeposit : 0,//首次实付押金\n        hasPay:0,//需支付金额\n        destroyInfo: {\n          searchShow: false,\n          searchMenuSpan: 6,\n          tip: false,\n          border: true,\n          editBtn:false,\n          addBtn:false,\n          delBtn:false,\n          index: false,\n          viewBtn: false,\n          selection: false,\n          searchBtn: false,\n          filterBtn: false,\n          refreshBtn: false,\n          columnBtn: false,\n          menu: true,\n          headerAlign: 'center',\n          align: 'center',\n          column: [\n            {\n              label: \"损坏部位\",\n              prop: \"where\",\n              search:true,\n              slot: true,\n              rules: [{\n                required: true,\n                message: \"请输入订单编号\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"问题说明\",\n              prop: \"info\",\n              search:true,\n              slot: true,\n              rules: [{\n                required: true,\n                message: \"请输入订单编号\",\n                trigger: \"blur\"\n              }]\n            }\n          ]\n        },\n        option: {\n          searchShow: false,\n          searchMenuSpan: 6,\n          tip: false,\n          border: true,\n          editBtn:false,\n          addBtn:false,\n          delBtn:false,\n          index: false,\n          viewBtn: false,\n          selection: false,\n          searchBtn: false,\n          filterBtn: false,\n          refreshBtn: false,\n          columnBtn: false,\n          menuWidth:100,\n          menu: true,\n          headerAlign: 'center',\n          align: 'center',\n          column: [\n            {\n              label: \"账单类型\",\n              prop: \"typeName\",\n              search:true,\n              slot: true,\n              rules: [{\n                required: true,\n                message: \"请输入订单编号\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"应付款日期\",\n              width: 120,\n              prop: \"startTime\",\n            },\n            {\n              label: \"账单金额\",\n              prop: \"money\",\n              slot: true,\n              rules: [{\n                required: true,\n                message: \"请输入商品ID\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"付款情况\",\n              prop: \"factPayMoney\",\n              slot: true,\n              width: 140,\n              rules: [{\n                required: true,\n                message: \"请输入商品ID\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"滞纳金\",\n              prop: \"allOverdueMoney\",\n              width: 140,\n              slot: true,\n              rules: [{\n                required: true,\n                message: \"请输入租期结束日\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"结余/欠款\",\n              width: 140,\n              prop: \"due\",\n              slot: true,\n              props: {\n                label: \"dictValue\",\n                value: \"dictKey\"\n              },\n            },\n          ]\n        },\n      };\n    },\n    watch: {\n      isShow(val, oldVal) {\n        if (!val){\n          this.$nextTick(() => {\n            this.end(true);\n          })\n        }\n      },\n      orderBills:{\n        handler (newVal,old) {\n          this.$nextTick(() => {\n            this.getAllDue()\n          })\n        },\n        deep:true\n      },\n    },\n    created () {\n\n    },\n    activated () { },\n    mounted() {\n      if (this.param.depositType){\n        this.depositType = this.param.depositType;\n      }\n        if (this.param.destroyJson){\n            this.destroy = JSON.parse(this.param.destroyJson)\n            console.log(this.destroy)\n        }\n      this.orderBills = [];\n      for (const item of this.param.bills) {\n        item.hasPay = true;\n        item.cancel = false;\n        if (item.status == 1) {\n          item.cancel = true\n        }\n        this.orderBills.push({...item})\n      }\n\n      console.log(this.offlineForm)\n    },\n    methods: {\n      goodsInfo(){\n        vue.$router.push({\n          path: \"/goods/view/index\",\n          query: {\n            goodsId : this.param.goodsId,\n          },\n        });\n        this.isShow = false;\n      },\n      viewImage(data){\n        if (data.file){\n          this.imageslist = [];\n          this.imageslist.push(vue.$store.state.common.cloudDomain+data.file)\n        }\n        console.log(this.imageslist)\n        this.showViewer2 = true;\n      },\n      addBill(){\n        this.$refs[\"billForm\"].validate((valid) => {\n          if (valid) {\n            // alert('submit!');\n            if (!isNaN(parseFloat(this.destoryBill.money)) && isFinite(this.destoryBill.money)){\n              if (this.orderBills[this.orderBills.length-1].type != 8){\n                this.orderBills.push(this.destoryBill);\n              }\n              this.dialogFormVisible = false\n            }else{\n              this.$message.error('金额必须为数字');\n            }\n          } else {\n            console.log('error submit!!');\n            return false;\n          }\n        });\n\n      },\n        getOrderNperNumber(val){\n            console.log(val)\n            if (val.row.type == 5){\n                return \"第\"+val.row.orderNumber+\"期租金\"\n            }else{\n                return val.label;\n            }\n        },\n      /**\n       * 总欠款\n       * @param val\n       * @returns {string|*}\n       */\n      getAllDue(){\n        this.allDue=0;//总欠款\n          this.allRent= 0;//总租金\n          this.reduction= 0;//减免\n          this.allDeposit=0;//总押金\n          this.paid= 0;//已付\n          this.leaveDeposit=0;//剩余押金\n          this.totleMoney=0;//汇总\n          this.firstDeposit = 0;//首次实付押金\n          this.hasPay=0;//需支付金额\n        for (const bill of this.orderBills) {\n          if (bill.type == 2&&Number.parseFloat(bill.factPayMoney)>0){//说明是首次押金，并且不是免押\n            this.firstDeposit = floatObj.add(this.firstDeposit,Number.parseFloat(bill.factPayMoney))//\n            continue;\n          }\n          if (bill.type == 3&&Number.parseFloat(bill.factPayMoney)>0){//说明是二次押金\n            this.allDeposit = floatObj.add(this.allDeposit,Number.parseFloat(bill.factPayMoney))\n            this.paid = floatObj.add(this.paid,Number.parseFloat(bill.factPayMoney))\n            continue;\n          }\n          var money = Number.parseFloat(bill.money)-(Number.parseFloat(bill.factPayMoney)+Number.parseFloat(bill.reductionMoney)+Number.parseFloat(bill.couponMoney)+Number.parseFloat(bill.depositMoney))\n          money = toFixed(money,2)\n          if (bill.hasPay){\n            this.allDue = floatObj.add(this.allDue,money);\n          }\n          this.paid = floatObj.add(this.paid,Number.parseFloat(bill.factPayMoney))\n          if(Number.parseFloat(bill.hasOverduePayMoney)>0){\n            this.paid = floatObj.add(this.paid,Number.parseFloat(bill.hasOverduePayMoney))\n          }\n          if (bill.type == 5){\n            this.allRent = floatObj.add(this.allRent,Number.parseFloat(bill.money));\n          }\n          this.reduction = floatObj.add(this.reduction,Number.parseFloat(bill.reductionMoney))\n        }\n\n        if (this.firstDeposit>0){\n          this.leaveDeposit = floatObj.subtract(this.firstDeposit,this.paid);\n        }else{\n          this.leaveDeposit = this.allDeposit;\n        }\n        var le = 0;\n        if (this.firstDeposit>0){\n          le = floatObj.subtract(this.firstDeposit,this.paid);\n        }else{\n          le = this.allDeposit;\n        }\n        console.log(\"allDue\",this.allDue)\n        var all = toFixed(floatObj.subtract(le,this.allDue),2);\n        this.totleMoney = all>=0?(all+\"(结余)\"):(all+\"(欠款)\");\n        this.hasPay = all;\n\n        if (this.depositType==2){\n          this.offlineForm.payMoney = 0\n          if(this.hasPay<0){\n            this.offlineForm.payMoney = Math.abs(all)\n          }\n          if(this.hasPay>0){\n            this.offlineForm.returnMoney = this.hasPay\n          }\n        }\n        if (this.depositType==1){\n          this.offlineForm.payMoney = this.allDue\n          this.offlineForm.returnMoney = this.leaveDeposit\n        }\n      },\n      getDue(bill){\n        var money = Number.parseFloat(bill.money)-(Number.parseFloat(bill.factPayMoney)+Number.parseFloat(bill.reductionMoney)+Number.parseFloat(bill.couponMoney)+Number.parseFloat(bill.depositMoney))\n        money = toFixed(money,2)\n        if (money<0){\n          return \"结余\"+money;\n        }else if (money == 0){\n          return \"结清\"\n        }else{\n          return \"欠款\"+money;\n        }\n      },\n        getLeaseTypeTitle(val){\n            var ss = leaseTypeTitle(val)\n            return ss;\n        },\n        getBuyoutPrice(val){\n            return buyoutPrice(val,this.param.totalPricesRate)\n        },\n        getPackageName(val){\n            return packageName(val);\n        },\n        getNperNumber(){\n            return indexNumber(this.param,this.orderBills);\n        },\n        getNowBuyoutMoney(){\n            return this.getBuyoutPrice(this.param.goodsCombinationJson)-this.getNperNumber()*this.param.rentPerMoney\n        },\n        getBuyoutBalancePayment(){\n            return buyoutBalancePayment(this.param.goodsCombinationJson);\n        },\n        getSecondDeposit(){\n            return secondDeposit(this.param.bills);\n        },\n      headers(){\n        return headers()\n      },\n      closeFn () {\n      },\n      handleAvatarSuccess(res, file) {\n        this.imageUrl = URL.createObjectURL(file.raw);\n      },\n      beforeAvatarUpload(file) {\n        const isJPG = file.type === 'image/jpeg';\n        const isLt2M = file.size / 1024 / 1024 < 2;\n\n        if (!isJPG) {\n          this.$message.error('上传头像图片只能是 JPG 格式!');\n        }\n        if (!isLt2M) {\n          this.$message.error('上传头像图片大小不能超过 2MB!');\n        }\n        return isJPG && isLt2M;\n      },\n      submit(payType){\n        var data = {};\n        data.payType = payType;\n        data.orderId = this.param.id;\n        data.type = 1;\n        data.needPay = 0\n        data.needReturn = 0\n        data.depositType = this.depositType;\n        if (this.depositType==2&&this.hasPay<0){\n          data.needPay = Math.abs(this.hasPay)\n        }else if (this.depositType==2&&this.hasPay>0){\n          data.needReturn = Math.abs(this.hasPay)\n        }else if (this.depositType==1){\n          data.needPay = this.allDue>=0?this.allDue:0;\n          data.needReturn = this.leaveDeposit>=0?this.leaveDeposit:0;\n        }\n\n        data.leaveDeposit = this.leaveDeposit;\n\n        console.log(this.offlineForm.images)\n       if (payType == 1 &&(!this.offlineForm.images||this.offlineForm.images.length == 0)){\n         this.$message.error('请上传线下转账凭证');\n         return;\n       }\n        console.log(this.offlineForm.images)\n        if (this.offlineForm.images&&this.offlineForm.images.length > 0){\n          data.image = this.offlineForm.images.join(\",\")\n        }\n\n        data.bills = this.orderBills;\n\n        console.log(data)\n\n        settlement(data).then(res => {\n          vue.$message({\n            type: 'success',\n            message: '结算成功成功!'\n          });\n          this.isOfflineShow = false;\n          this.onlineShow = false;\n          this.isShow = false\n          this.$nextTick(() => {\n            this.end(true);\n          })\n        }).catch(res => {\n          console.log(res)\n        });\n      }\n    },\n  };\n</script>\n<style scoped>\n  .bottom{\n    padding-bottom: 0px !important;\n    margin-bottom: 0px !important;\n  }\n  :deep .avue-crud__menu {\n    display: none;\n  }\n  :deep .el-empty {\n    padding: 0px 0px !important;\n  }\n  :deep .avue-crud__empty {\n    padding: 0px 0px !important;\n  }\n  :deep .el-empty__image {\n    display: none;\n  }\n  :deep .el-table--small .el-table__cell {\n      padding: 0px 0px !important;\n  }\n</style>\n"]}]}