{"remainingRequest":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workCode\\xiaoE\\大圣系统源码\\admin\\src\\views\\operation\\coupon.vue?vue&type=style&index=0&id=61915230&lang=css&","dependencies":[{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\src\\views\\operation\\coupon.vue","mtime":1678264930000},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\css-loader\\index.js","mtime":1678778409149},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1678778410194},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1678778410012},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678778409044},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1678778410194}],"contextDependencies":[],"result":["\n.input-with-select .el-input-group__prepend {\n  background-color: #fff;\n}\n",{"version":3,"sources":["coupon.vue"],"names":[],"mappings":";AAwnBA;AACA;AACA","file":"coupon.vue","sourceRoot":"src/views/operation","sourcesContent":["<template>\n  <basic-container>\n    <avue-crud :option=\"option\"\n               :table-loading=\"loading\"\n               :data=\"data\"\n               :page=\"page\"\n               :permission=\"permissionList\"\n               :before-open=\"beforeOpen\"\n               v-model=\"form\"\n               ref=\"crud\"\n               @row-update=\"rowUpdate\"\n               @row-save=\"rowSave\"\n               @row-del=\"rowDel\"\n               @search-change=\"searchChange\"\n               @search-reset=\"searchReset\"\n               @selection-change=\"selectionChange\"\n               @current-change=\"currentChange\"\n               @size-change=\"sizeChange\"\n               @on-load=\"onLoad\">\n      <template slot=\"menuLeft\">\n        <el-button type=\"danger\"\n                   size=\"small\"\n                   icon=\"el-icon-delete\"\n                   plain\n                   v-if=\"permission.coupon_delete\"\n                   @click=\"handleDelete\">删 除\n        </el-button>\n      </template>\n      <template slot=\"typeLimitDateForm\" slot-scope=\"{type,disabled}\">\n        <el-input v-model=\"form.typeLimitDate\" class=\"input-with-select\">\n          <el-select ref=\"selectInput\" disabled=\"true\" slot=\"append\" v-model=\"form.typeLimitDateUnit\" style=\"width: 60px!important\">\n            <el-option label=\"年\" value=\"年\"></el-option>\n            <el-option label=\"月\" value=\"月\"></el-option>\n            <el-option label=\"日\" value=\"日\"></el-option>\n          </el-select>\n        </el-input>\n      </template>\n    </avue-crud>\n  </basic-container>\n</template>\n\n<script>\n  import {getList, getDetail, add, update, remove} from \"@/api/operation/coupon\";\n  import {mapGetters} from \"vuex\";\n\n  export default {\n    data() {\n      return {\n        form: {},\n        query: {},\n        loading: true,\n        page: {\n          pageSize: 10,\n          currentPage: 1,\n          total: 0\n        },\n        selectionList: [],\n        option: {\n          height: 'auto',\n          calcHeight: 210,\n          searchShow: true,\n          searchMenuSpan: 6,\n          tip: false,\n          border: true,\n          viewBtn: true,\n          selection: true,\n          labelWidth: 100,\n          searchLabelWidth: 100,\n          column: [\n            {\n              label: \"id\",\n              prop: \"id\",\n              display: false,\n              rules: [{\n                required: true,\n                message: \"请输入id\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"优惠券名称\",\n              prop: \"name\",\n              span: 24,\n              rules: [{\n                required: true,\n                message: \"请输入优惠券名称\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"优惠券类别\",\n              prop: \"type\",\n              type: \"select\",\n              search: true,\n              dicUrl: \"/api/blade-system/dict/dictionary?code=coupon_type\",\n              props: {\n                label: \"dictValue\",\n                value: \"dictKey\"\n              },\n              rules: [{\n                required: true,\n                message: \"请输入优惠券类别\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"优惠券面额\",\n              prop: \"money\",\n              rules: [{\n                required: true,\n                message: \"请输入优惠券面额\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"发放总量\",\n              prop: \"count\",\n              rules: [{\n                required: true,\n                message: \"请输入发放总量\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"限领数量\",\n              prop: \"countLimit\",\n              rules: [{\n                required: true,\n                message: \"请输入限领数量\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"金额限制\",\n              prop: \"moneyLimit\",\n              placeholder: \"请输入金额限制 0无限制\",\n              rules: [{\n                required: true,\n                message: \"请输入金额限制 0无限制\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"时间限制\",\n              prop: \"dateLimit_none\",\n              display: false,\n              formatter: function(row){\n                if(row.dateLimit == 1){\n                  return row.startDate + \" - \" + row.endDate;\n                }else if(row.dateLimit == 2){\n                  return \"自领取\"+row.dateLimitDays+\"天内使用\";\n                }\n              }\n            },\n            {\n              label: \"状态\",\n              prop: \"status\",\n              type: \"radio\",\n              value: 1,\n              search: true,\n              dicUrl: \"/api/blade-system/dict/dictionary?code=coupon_status\",\n              props: {\n                label: \"dictValue\",\n                value: \"dictKey\"\n              }\n            },\n            {\n              label: \"优惠券说明\",\n              prop: \"content\",\n              span: 24,\n              hide: true,\n              rules: [{\n                required: true,\n                message: \"请输入优惠券说明\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"有效期限制\",\n              prop: \"dateLimit\",\n              type: \"radio\",\n              value: 1,\n              dicData:[\n                {\n                  label: \"固定时间\",\n                  value: 1\n                },\n                {\n                  label: \"领取时间按天数顺延\",\n                  value: 2\n                }\n              ],\n              hide: true,\n              control:(val)=> {\n                if (val === 1) {\n                  console.info(1)\n                  return {\n                    dateLimitDays: {\n                      display: false\n                    },\n                    dateLimitRange: {\n                      display: true\n                    }\n                  }\n                } else {\n                  console.info(2)\n                  return {\n                    dateLimitDays: {\n                      display: true\n                    },\n                    dateLimitRange: {\n                      display: false\n                    }\n                  }\n                }\n              }\n            },\n            {\n              label: \"有效期\",\n              prop: \"dateLimitRange\",\n              type: \"daterange\",\n              format:'yyyy-MM-dd',\n              valueFormat:'yyyy-MM-dd',\n              startPlaceholder: '日期开始范围自定义',\n              endPlaceholder: '日期结束范围自定义',\n              hide: true,\n              display: true,\n              rules: [{\n                required: true,\n                message: \"请选择有效期\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"顺延天数\",\n              prop: \"dateLimitDays\",\n              hide: true,\n              display: false,\n              rules: [{\n                required: true,\n                message: \"请输入领取时间顺延天数\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"生效条件\",\n              prop: \"typeLimit\",\n              type:\"radio\",\n              value: 0,\n              hide: true,\n              dicData:[\n                {\n                  label: \"无限制\",\n                  value: 0\n                },\n                {\n                  label: \"租期未满期数不可使用\",\n                  value: 1\n                },\n                {\n                  label: \"提前付款天数可以使用\",\n                  value: 2\n                }\n              ],\n              change: ({value,column,item,dic}) => {\n                this.$nextTick(function(){\n                  if(value == 2) {\n                    this.$refs.selectInput.value = \"日\";\n                  }else{\n                    this.$refs.selectInput.value = \"月\";\n                  }\n                });\n              },\n              control:(val)=>{\n                if(val===0){\n                  return {\n                    typeLimit:{\n                      span: 24,\n                    },\n                    typeLimitDate : {\n                      display: false\n                    }\n                  }\n                }else{\n\n                  return {\n                    typeLimit:{\n                      span: 12,\n                    },\n                    typeLimitDate : {\n                      display: true\n                    }\n                  }\n                }\n              },\n            },\n            {\n              label: \"限制日期\",\n              prop: \"typeLimitDate\",\n              formslot: \"true\",\n              display: true,\n              hide: true,\n              rules: [{\n                required: true,\n                message: \"请输入限制日期\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"适用范围\",\n              prop: \"rangeLimit\",\n              type:\"radio\",\n              value: 0,\n              hide: true,\n              dicData:[\n                {\n                  label: \"无限制\",\n                  value: 0\n                },\n                {\n                  label: \"分类限制\",\n                  value: 1\n                },\n                {\n                  label: \"商品限制\",\n                  value: 2\n                }\n              ],\n              control:(val)=>{\n                if(val===0){\n                  return {\n                    rangeLimit:{\n                      span: 24,\n                    },\n                    categoryIds : {\n                      display: false\n                    },\n                    goodsIds : {\n                      display: false\n                    }\n                  }\n                }else if(val===1){\n                  return {\n                    rangeLimit:{\n                      span: 12,\n                    },\n                    categoryIds : {\n                      display: true\n                    },\n                    goodsIds : {\n                      display: false\n                    }\n                  }\n                }else if(val===2){\n                  return {\n                    rangeLimit:{\n                      span: 12,\n                    },\n                    categoryIds : {\n                      display: false\n                    },\n                    goodsIds : {\n                      display: true\n                    }\n                  }\n                }\n              },\n            },\n            {\n              label: \"选择分类\",\n              prop: \"categoryIds\",\n              hide: true,\n              type: \"cascader\",\n              dataType: \"string\",\n              dicUrl: \"/api/blade-goods/goodscategory/tree\",\n              props: {\n                label: \"title\",\n                value: \"id\"\n              },\n              emitPath:false,\n              multiple: true,\n              display: false,\n              rules: [{\n                required: true,\n                message: \"请选择分类\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"选择商品\",\n              prop: \"goodsIds\",\n              hide: true,\n              type: \"select\",\n              dataType: \"string\",\n              remote: true,\n              dicUrl: \"/api/blade-goods/goods/select?title={{key}}\",\n              props: {\n                label: \"title\",\n                value: \"id\"\n              },\n              emitPath:false,\n              multiple: true,\n              display: false,\n              rules: [{\n                required: true,\n                message: \"请选择商品\",\n                trigger: \"blur\"\n              }]\n            },\n            {\n              label: \"适用人群\",\n              prop: \"clientLimit\",\n              type: \"radio\",\n              value: 0,\n              span: 24,\n              hide: true,\n              dicData:[\n                {\n                  label: \"所有人\",\n                  value: 0\n                },\n                {\n                  label: \"指定人群\",\n                  value: 1\n                },\n                {\n                  label: \"新用户\",\n                  value: 2\n                },\n                // {\n                //   label: \"自动赠送\",\n                //   value: 3\n                // }\n              ],\n              control:(val)=>{\n                if(val === 1){\n                  return {\n                    phoneLimit: {\n                      display: true\n                    }\n                  }\n                }else{\n                  return {\n                    phoneLimit: {\n                      display: false\n                    }\n                  }\n                }\n              }\n            },\n            {\n              label: \"手机号码\",\n              prop: \"phoneLimit\",\n              type: \"textarea\",\n              placeholder: \"请输入手机号码以英文逗号','分隔\",\n              span: 24,\n              hide: true,\n              display: false,\n              rules: [{\n                required: true,\n                message: \"请输入手机号码以英文逗号','分隔\",\n                trigger: \"blur\"\n              }]\n            },\n          ]\n        },\n        data: []\n      };\n    },\n    computed: {\n      ...mapGetters([\"permission\"]),\n      permissionList() {\n        return {\n          addBtn: this.vaildData(this.permission.coupon_add, false),\n          viewBtn: this.vaildData(this.permission.coupon_view, false),\n          delBtn: this.vaildData(this.permission.coupon_delete, false),\n          editBtn: this.vaildData(this.permission.coupon_edit, false)\n        };\n      },\n      ids() {\n        let ids = [];\n        this.selectionList.forEach(ele => {\n          ids.push(ele.id);\n        });\n        return ids.join(\",\");\n      }\n    },\n    methods: {\n      rowSave(row, done, loading) {\n        let ds = row.dateLimitRange;\n        if(ds != null && ds.length > 0){\n          row.startDate = ds[0];\n          row.endDate = ds[1];\n        }\n        if(row.rangeLimit == 1){\n          row.rangeIds = row.categoryIds;\n        }else if(row.rangeLimit == 2){\n          row.rangeIds = row.goodsIds;\n        }\n        add(row).then(() => {\n          done();\n          this.onLoad(this.page);\n          this.$message({\n            type: \"success\",\n            message: \"操作成功!\"\n          });\n        }, error => {\n          window.console.log(error);\n          loading();\n        });\n      },\n      rowUpdate(row, index, done, loading) {\n        let ds = row.dateLimitRange;\n        if(ds != null && ds.length > 0){\n          row.startDate = ds[0];\n          row.endDate = ds[1];\n        }\n        if(row.rangeLimit == 1){\n          row.rangeIds = row.categoryIds;\n        }else if(row.rangeLimit == 2){\n          row.rangeIds = row.goodsIds;\n        }\n        update(row).then(() => {\n          done();\n          this.onLoad(this.page);\n          this.$message({\n            type: \"success\",\n            message: \"操作成功!\"\n          });\n        }, error => {\n          window.console.log(error);\n          loading();\n        });\n      },\n      rowDel(row) {\n        this.$confirm(\"确定将选择数据删除?\", {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        })\n          .then(() => {\n            return remove(row.id);\n          })\n          .then(() => {\n            this.onLoad(this.page);\n            this.$message({\n              type: \"success\",\n              message: \"操作成功!\"\n            });\n          });\n      },\n      handleDelete() {\n        if (this.selectionList.length === 0) {\n          this.$message.warning(\"请选择至少一条数据\");\n          return;\n        }\n        this.$confirm(\"确定将选择数据删除?\", {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        })\n          .then(() => {\n            return remove(this.ids);\n          })\n          .then(() => {\n            this.onLoad(this.page);\n            this.$message({\n              type: \"success\",\n              message: \"操作成功!\"\n            });\n            this.$refs.crud.toggleSelection();\n          });\n      },\n      beforeOpen(done, type) {\n        if ([\"edit\", \"view\"].includes(type)) {\n          getDetail(this.form.id).then(res => {\n            let data = res.data.data;\n            data.dateLimitRange = [data.startDate,data.endDate];\n\n            if(data.rangeLimit == 1){\n              data.categoryIds = data.rangeIds;\n            }else if(data.rangeLimit == 2){\n              data.goodsIds = data.rangeIds;\n            }\n\n            this.form = data;\n            console.info(this.form);\n          });\n        }\n        if(this.form.typeLimitDateUnit == null){\n          this.form.typeLimitDateUnit = \"月\";\n        }\n        done();\n      },\n      searchReset() {\n        this.query = {};\n        this.onLoad(this.page);\n      },\n      searchChange(params, done) {\n        this.query = params;\n        this.page.currentPage = 1;\n        this.onLoad(this.page, params);\n        done();\n      },\n      selectionChange(list) {\n        this.selectionList = list;\n      },\n      selectionClear() {\n        this.selectionList = [];\n        this.$refs.crud.toggleSelection();\n      },\n      currentChange(currentPage){\n        this.page.currentPage = currentPage;\n      },\n      sizeChange(pageSize){\n        this.page.pageSize = pageSize;\n      },\n      onLoad(page, params = {}) {\n        this.loading = true;\n        getList(page.currentPage, page.pageSize, Object.assign(params, this.query)).then(res => {\n          const data = res.data.data;\n          this.page.total = data.total;\n          this.data = data.records;\n          this.loading = false;\n          this.selectionClear();\n        });\n      }\n    }\n  };\n</script>\n\n<style>\n.input-with-select .el-input-group__prepend {\n  background-color: #fff;\n}\n</style>\n"]}]}