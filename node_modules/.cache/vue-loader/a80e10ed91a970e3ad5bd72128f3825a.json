{"remainingRequest":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workCode\\xiaoE\\大圣系统源码\\admin\\src\\views\\goods\\goods_add.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\src\\views\\goods\\goods_add.vue","mtime":1678509654000},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678778409044},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1678778390429},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678778409044},{"path":"D:\\workCode\\xiaoE\\大圣系统源码\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1678778410194}],"contextDependencies":[],"result":["\n  import {categoryTree, getList} from \"../../api/goods/goodscategory\";\n  import {getDetail} from \"@/api/goods/goods\";\n  import {dictionary} from \"../../api/system/dict\";\n  import {getList as getExtraserviceList} from \"../../api/goods/extraservice\";\n  import {getList as getReturnAddressList} from \"../../api/goods/returnaddress\";\n  import {getAllList as getMaintaininfoList} from \"../../api/operation/maintaininfo\";\n  import {getAllList as getRentinfoList} from \"../../api/operation/rentinfo\";\n  import {Base64} from 'js-base64';\n  import {getToken, headers} from '../../util/auth'\n  import website from '../../config/website';\n  import {\n    calculateBuyoutMoney, calculateLateFeeMoney,\n    calculateRentMoney,\n    calculatePerRentMoney, floatObj,\n  } from \"../../constant/goods/constant\";\n  import {saveOrUpdate} from \"../../api/goods/goods\";\n  import func from \"../../util/func\";\n  import {Message} from 'element-ui'\n\n  export default {\n    name: \"wel\",\n    data() {\n      return {\n        table_key:0,\n        loading:false,\n        rules:{\n          levelFirstCategoryId: [\n            { required: true, message: '请请选择类目', trigger: 'blur' },\n          ],\n          levelSecondCategoryId: [\n            { required: true, message: '请请选择类目', trigger: 'blur' },\n          ],\n          title: [\n            { required: true, message: '请输入商品标题', trigger: 'blur' },\n          ],\n          returnAddressId: [\n            { required: true, message: '请选择归还地址', trigger: 'blur' },\n          ],\n          leaseExplainId: [\n            { required: true, message: '请选择租赁说明', trigger: 'blur' },\n          ],\n          afterSaleId: [\n            { required: true, message: '请选择售后维修说明', trigger: 'blur' },\n          ],\n          totalPricesRate: [\n            { required: true, message: '请输入总价系数', trigger: 'blur' },\n          ],\n          periodType: [\n            { required: true, message: '请选择租期', trigger: 'blur' },\n          ],\n          expressFree: [\n            { required: true, message: '请选择快递方式', trigger: 'blur' },\n          ],\n          expressPrice:[\n            { required: true, message: '请输入邮费', trigger: 'blur' },\n          ],\n        },\n        sales:{\n          deleteCombination:[],\n          deleteSpecification:[],\n          photoCover:[],\n          photoDetails:[],\n          photoSlideshow:[],\n          levelFirstCategoryId: '',\n          levelSecondCategoryId: '',\n          title: '',\n          network: '',\n          marketing: '',\n          oldNew: '0',\n          secondHand: '100',\n          marketingCornerMark: '',\n          extraService: [],\n          returnAddressId: '',\n          leaseExplainId: '',\n          afterSaleId: '',\n          expressFree:\"1\",\n          expressPrice:null,\n          limitUser:null,\n          totalPricesRate: 0,\n          tags: [],\n          inputVisible: false,\n          inputValue: '',\n          value1: [],\n          periodType: null,//期数单位\n          billingCycle: 0,//账单周期\n          specifications:[],\n          planInfo: {\n            type_1: {\n              type:1,\n              typeTitle: '月供低 年年焕新',\n              rentType:false,\n              rentRate: null,\n              lateFeeRate: null,\n              renewalRate: null,\n              miniLease: null,\n              name:null,\n              miniType: null,\n              maxLease: null,\n              maxType: null,\n              buyoutBalancePayment:null,\n            },\n            // type_2: {\n            //   type:2,\n            //   rentType:false,\n            //   rentRate: null,\n            //   lateFeeRate: null,\n            //   renewalRate: null,\n            //   miniLease: null,\n            //   name:null,\n            //   miniType: null,\n            //   maxLease: null,\n            //   maxType: null,\n            //   buyoutBalancePayment:null,\n            // },\n            type_3: {\n              type:3,\n              typeTitle: '个月内随时续租/买断/归还/续满即送',\n              rentType:false,\n              rentRate: null,\n              lateFeeRate: null,\n              renewalRate: null,\n              miniLease: null,\n              name:null,\n              miniType: null,\n              maxLease: null,\n              maxType: null,\n              buyoutBalancePayment:100,\n            },\n          },\n        },\n        specifications:[],\n        photoCover:[],\n        photoDetails:[],\n        photoSlideshow:[],\n        uploadDisabled:false,\n        id:null,\n        levelFirstCategoryId: [],\n        levelSecondCategoryId: [],\n        newWorks: [],\n        hands: [],\n        usePlan:0,\n        extraServices: [],\n        returnAddresses: [],\n        mainTainInfos: [],\n        expressList: [{\n          value: '1',\n          label: '包邮'\n        }, {\n          value: '2',\n          label: '不包邮'\n        }],\n        rentinfos: [],\n        planInfos: {\n          type_1:\n            {\n              type: 1,\n              typeName: this.$enum.defaultReturn.typeName,\n              typeInfo: this.$enum.defaultReturn.typeInfo,\n              rentRate: this.$enum.defaultReturn.rentRate,\n              lateFeeRate: this.$enum.defaultReturn.lateFeeRate,\n              renewalRate: this.$enum.defaultReturn.renewalRate,\n              miniLease: this.$enum.defaultReturn.miniLease,\n              miniType: this.$enum.defaultReturn.miniType,\n              maxLease: this.$enum.defaultReturn.maxLease,\n              maxType: this.$enum.defaultReturn.maxType,\n              miniLeaseList:this.$enum.defaultReturn.miniLeaseList,\n              maxLeaseList:this.$enum.defaultReturn.maxLeaseList,\n            },\n          // type_2: {\n          //   type: 2,\n          //   typeName: this.$enum.defaultBuyout.typeName,\n          //   typeInfo: this.$enum.defaultBuyout.typeInfo,\n          //   rentRate: this.$enum.defaultBuyout.rentRate,\n          //   lateFeeRate: this.$enum.defaultBuyout.lateFeeRate,\n          //   renewalRate: this.$enum.defaultBuyout.renewalRate,\n          //   miniLease: this.$enum.defaultBuyout.miniLease,\n          //   miniType: this.$enum.defaultBuyout.miniType,\n          //   maxLease: this.$enum.defaultBuyout.maxLease,\n          //   maxType: this.$enum.defaultBuyout.maxType,\n          //   miniLeaseList:this.$enum.defaultBuyout.miniLeaseList,\n          //   maxLeaseList:this.$enum.defaultBuyout.maxLeaseList,\n          // },\n          type_3: {\n            type: 3,\n            typeName: this.$enum.defaultFlexible.typeName,\n            typeInfo: this.$enum.defaultFlexible.typeInfo,\n            rentRate: this.$enum.defaultFlexible.rentRate,\n            lateFeeRate: this.$enum.defaultFlexible.lateFeeRate,\n            renewalRate: this.$enum.defaultFlexible.renewalRate,\n            miniLease: this.$enum.defaultFlexible.miniLease,\n            miniType: this.$enum.defaultFlexible.miniType,\n            maxLease: this.$enum.defaultFlexible.maxLease,\n            maxType: this.$enum.defaultFlexible.maxType,\n            miniLeaseList:this.$enum.defaultFlexible.miniLeaseList,\n            maxLeaseList:this.$enum.defaultFlexible.maxLeaseList,\n          }\n        },\n        images: {\n            photoCover:{\n              isShow:false,\n              url: '',\n            },\n            photoDetails:{\n              isShow:false,\n              url: '',\n            },\n            photoSlideshow:{\n              isShow:false,\n              url: '',\n            }\n          },\n        spanArr: [],\n        plans: [],\n        columns: [\"packageName\", \"specification1\", \"specification2\",\"specification3\",\"specification4\",\"specification5\"],\n      }\n    },\n    watch: {\n      option: function (){\n        console.log(\"option变化了\")\n        this.table_key = new Date().getTime();\n      },\n      'sales.levelFirstCategoryId': function (val) {\n        this.getCategory(val)\n      },\n      'sales.levelSecondCategoryId': function (val) {\n        this.sales.tags = []\n        this.referTags(this.levelFirstCategoryId, this.sales.levelFirstCategoryId);\n        this.referTags(this.levelSecondCategoryId, val);\n        console.log(this.tags)\n      },\n      'sales.extraService': function (val) {\n\n      },\n      'sales.totalPricesRate': function (val, oldVal) {\n        if (Number.parseFloat(val)>1.5){\n          this.$message.error(\"总价系数不能超过1.5\");\n          this.sales.totalPricesRate = oldVal;\n          return;\n        }\n      },\n      'sales.periodType': function (val) {\n        this.reset(\"type_1\",val);\n        // this.reset(\"type_2\",val);\n        this.reset(\"type_3\",val);\n      },\n    },\n    methods: {\n      changePackageName(val,row){\n        row.packageName = val;\n        console.log(val,row)\n      },\n      getchangeSpecification(name,data,val,row){\n        const newObj = Object.assign({},data)\n        newObj.lableName = name;\n        delete newObj.name\n        console.log(this.plans,val,row)\n        return Object.assign(newObj,val);\n      },\n      changeSpecification(data,val,row){\n        // const newObj = Object.assign({},data)\n        // newObj.lableName = newObj.name;\n        // delete newObj.name\n        // delete newObj.attr\n        // Object.assign(row,Object.assign(newObj,val))\n        // console.log(this.plans,val,row)\n      },\n      handler() {\n        const items = {};\n        const rentTypes = {}\n        this.usePlan = 0;\n        for (const type in this.sales.planInfo) {\n          const planInfo = this.sales.planInfo[type];\n          if (planInfo.rentType){\n            const defaults = this.$enum.defaultPlanInfo[type];\n            planInfo.name = defaults.typeName\n            rentTypes[defaults.typeName] = planInfo\n          }\n        }\n        this.specifications = []\n        for (let index  in  this.sales.specifications){\n          const  item = this.sales.specifications[index]\n          if (item.name&&item.name.length>0&&item.isGroup == true){\n            this.usePlan = this.usePlan+1;\n            for (const it of item.attr) {\n              items[it.name] = it\n            }\n            this.specifications.push(item)\n          }\n        }\n        var keys = Object.keys(items);\n\n        for (const plan of this.plans) {\n\n          var  packageName = plan.packageName;\n          packageName = this.sales.planInfo[\"type_\"+packageName.type];\n          if (rentTypes[packageName.name]){\n            plan.packageName = rentTypes[packageName.name]\n          }\n          if (packageName.rentRate){\n            plan.rentRate = packageName.rentRate\n          }\n          if (packageName.rentRate){\n            plan.rentRate = packageName.rentRate\n          }\n          if (packageName.lateFeeRate){\n            plan.lateFeeMoney = packageName.lateFeeRate\n          }\n          if (packageName.miniLease){\n            plan.miniLease = packageName.miniLease\n          }\n          if (packageName.buyoutBalancePayment){\n            plan.buyoutBalancePayment = packageName.buyoutBalancePayment\n          }\n\n          for (let i = 0; i < this.usePlan; i++) {\n            var value = plan['specification'+(i+1)];\n            if (value&&items[value.name]){\n              if(items[value.name].websitePrice){\n                plan.websitePrice = items[value.name].websitePrice\n                plan.renewalPrice = items[value.name].renewalPrice\n              }\n            }\n          }\n        }\n        console.log(this.sales.planInfo)\n        for (const planKey in this.sales.planInfo) {\n          console.log(this.sales.planInfo[planKey].rentRate)\n          if (func.toFloat(this.sales.planInfo[planKey].rentRate,1)>1){\n            this.sales.planInfo[planKey].rentRate = 1;\n            this.$message.error(\"租金系数设置失败，租金系数最大能超过1\")\n          }\n          if (func.toFloat(this.sales.planInfo[planKey].lateFeeRate,1)>1){\n            this.sales.planInfo[planKey].lateFeeRate = 1;\n            this.$message.error(\"日滞纳金系数设置失败，滞纳金系数最大能超过1\")\n          }\n        }\n        // console.log(JSON.stringify(this.sales))\n        // console.log(JSON.stringify(this.plans))\n        this.rowspan()\n      },\n      getMaxList(value,key){\n        if (!this.sales.periodType){\n          return [];\n        }\n        return value.maxLeaseList[this.sales.periodType-1][this.$enum.goodsPlanInfo.miniIndex(key,this.sales.periodType,this.sales.planInfo[key].miniLease)]\n      },\n      checkNumber(val){\n        return parseFloat(val).toString() != \"NaN\";\n      },\n      //每一期租金\n      calculateRentMoney(row){\n        const  data = Object.assign({totalPricesRate:this.sales.totalPricesRate},row);\n        var rentPerMoney = calculatePerRentMoney(data);\n        row.rentMoney = calculateRentMoney(data);\n        row.rentPerMoney = rentPerMoney;\n        // console.log(\"行数据\",row)\n        return rentPerMoney;\n      },\n      calculateBuyoutMoney(row){\n        const  data = Object.assign({totalPricesRate:this.sales.totalPricesRate},row);\n        return calculateBuyoutMoney(data)\n      },\n      calculateLateFeeMoney(row){\n        const  data = Object.assign({totalPricesRate:this.sales.totalPricesRate},row);\n        return calculateLateFeeMoney(data);\n      },\n      changeStockout(data){\n        var index = data.index\n        this.plans[index].stockout = false;\n        this.plans[index].$cellEdit = true;\n        this.table_key = new Date().getTime();\n      },\n      deleteRow(index){\n        var item = this.plans[index];\n        if (item.id){\n          this.sales.deleteCombination.push(item.id)\n        }\n        this.plans.splice(index, 1)\n      },\n      reset(key,val){\n        this.sales.planInfo[key].rentType=false\n        this.sales.planInfo[key].miniLease=null\n        this.sales.planInfo[key].miniType=val\n        this.sales.planInfo[key].maxLease=null\n        this.sales.planInfo[key].maxType=val\n      },\n      doCombination(arr) {\n        var count = arr.length - 1; //数组长度(从0开始)\n        var tmp = [];\n        var totalArr = [];// 总数组\n\n        return doCombinationCallback(arr, 0);//从第一个开始\n        //js 没有静态数据，为了避免和外部数据混淆，需要使用闭包的形式\n        function doCombinationCallback(arr, curr_index) {\n          for(const val of arr[curr_index]) {\n            tmp[curr_index] = val;//以curr_index为索引，加入数组\n            //当前循环下标小于数组总长度，则需要继续调用方法\n            if(curr_index < count) {\n              doCombinationCallback(arr, curr_index + 1);//继续调用\n            }else{\n              totalArr.push(tmp);//(直接给push进去，push进去的不是值，而是值的地址)\n            }\n            //js  对象都是 地址引用(引用关系)，每次都需要重新初始化，否则 totalArr的数据都会是最后一次的 tmp 数据；\n           var oldTmp = tmp;\n            tmp = [];\n            for(const index of oldTmp) {\n              tmp.push(index);\n            }\n          }\n          return totalArr;\n        }\n      },\n      addAttr(item){\n        item.attr.push({\n          name:null,\n          websitePrice:null,\n          renewalPrice:null,\n        })\n      },\n      deAttr(items,index){\n        this.$delete(items,index)\n      },\n      savePlan(){\n        const keys = [];\n        for (const plan of this.plans) {\n          let key = plan.packageName.name;\n          if (!plan.packageName.name||plan.packageName.name.length==0){\n            this.$message(\"保存失败,请选择方案\")\n            return;\n          }\n          for (let i = 0; i < this.usePlan; i++) {\n            const name = plan['specification'+(i+1)].name;\n            key = key+name;\n            if (!name||name.length==0){\n              this.$message.error(\"保存失败,请选择规格\")\n              return;\n            }\n          }\n          if (keys.indexOf(key) != -1){\n            this.$message.error(\"保存失败,当前组合已存在\")\n            return;\n          }\n          keys.push(key)\n        }\n\n        for (const plan of this.plans) {\n          plan.add = false;\n        }\n        this.$nextTick(_ => {\n          this.rowspan()\n          this.table_key = new Date().getTime();\n          this.handler()\n        });\n      },\n      addPlan(){\n        var item = {};\n        item.add = true;\n        item.websitePrice = 0\n        item.lateFeeMoney = 0\n        item.miniLease = 0\n        item.rentRate = 0\n        item.$cellEdit=true\n        item.buyoutBalancePayment = 0\n        item.rowKey = new Date().getTime();\n        item.packageName = {name:\"\"}\n\n        var number = 0;\n        for (let index in this.sales.specifications) {\n          var specification = this.sales.specifications[index]\n          if (specification.name&&specification.name.length>0&&specification.isGroup == true){\n            number = number+1;\n            item['specification'+number] = {index:index}\n          }\n        }\n        // for (let i = 0; i < this.usePlan; i++) {\n        //   item['specification'+(i+1)] = {}\n        // }\n        item.stockout = false\n        item.inventory = 0\n        item.premiumMoney = 0\n        item.depositMoney = 0\n        item.rentMoney = 0\n        item.buyoutMoney = 0\n        var data = {\n          \"packageName\": 1,\n          \"stockout\": 1,\n          \"inventory\": 1,\n          \"websitePrice\": 1,\n          \"premiumMoney\": 1,\n          \"rentRate\": 1,\n          \"depositMoney\": 1,\n          \"miniLease\": 1,\n          \"rentMoney\": 1,\n          \"buyoutMoney\": 1,\n          \"lateFeeMoney\": 1\n        };\n        for (let i = 0; i < this.usePlan; i++) {\n          data['specification'+(i+1)] = 1\n        }\n        this.spanArr.push(data)\n        console.log(item)\n        this.plans.push(item)\n      },\n      addCombination(){\n        this.sales.specifications.push({\n          name:null,\n          isGroup:false,\n          isUploadPhoto:false,\n          isSetPrice:false,\n          attr:[{\n            name:null,\n            websitePrice:null,\n            renewalPrice:null,\n          }],\n        })\n      },\n      deSpecification(items,index){\n        var item = items[index];\n        if (item.id){\n          this.sales.deleteSpecification.push(item.id)\n        }\n        this.$delete(items,index)\n      },\n      onSubmit() {\n        console.log('submit!');\n      },\n      handleClose(tag) {\n        this.sales.tags.splice(this.sales.tags.indexOf(tag), 1);\n      },\n\n      showInput() {\n        this.sales.inputVisible = true;\n        this.$nextTick(_ => {\n          this.$refs.saveTagInput.$refs.input.focus();\n        });\n      },\n\n      handleInputConfirm() {\n        let inputValue = this.sales.inputValue;\n        if (inputValue) {\n          this.sales.tags.push(inputValue);\n        }\n        this.sales.inputVisible = false;\n        this.sales.inputValue = '';\n      },\n      rowSave(form, done) {\n        this.$message.success(\n          '新增数据' + JSON.stringify(form)\n        )\n        done()\n      },\n      handleRowClick(row, column,event) {\n        if ((event.target&&event.target.className === 'el-switch__core')){\n          row.$cellEdit = !row.$cellEdit;\n          row.inventory = 0;\n        }\n      },\n      addUpdate(form, index, done, loading) {\n        this.$message.success('模拟网络请求')\n        setTimeout(() => {\n          this.$message.success('关闭按钮等待')\n          loading()\n        }, 1000)\n        setTimeout(() => {\n          this.$message.success(\n            '编辑数据' + JSON.stringify(form) + '数据序号' + index\n          )\n          done()\n        }, 2000)\n      },\n      rowspan() {\n        // this.spanArr = [[3,2,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]\n        this.spanArr.splice(0);\n        var proKeys = \"\";\n        this.plans.forEach((item, index) => {\n          var data = {\n            \"packageName\": 1,\n            \"stockout\": 1,\n            \"inventory\": 1,\n            \"websitePrice\": 1,\n            \"premiumMoney\": 1,\n            \"rentRate\": 1,\n            \"depositMoney\": 1,\n            \"miniLease\": 1,\n            \"rentMoney\": 1,\n            \"buyoutMoney\": 1,\n            \"lateFeeMoney\": 1\n          };\n          console.log(\"规格数量:\",this.usePlan)\n          for (let i = 0; i < this.usePlan; i++) {\n            data['specification'+(i+1)] = 1\n          }\n          this.spanArr.push(data)\n          Object.keys(item).forEach((second, index2) => {\n            if (this.columns.indexOf(second) != -1){\n              proKeys = proKeys + item[second].name;\n              // console.log(\"添加key\",proKeys)\n            }\n          })\n          // console.log(\"上一次的索引:\"+proKeys)\n          if (index > 0&&!item.add) {\n            var keys = \"\";\n            Object.keys(item).forEach((second, index2) => {\n              if (this.columns.indexOf(second) != -1) {\n                keys = keys + item[second].name;\n                // console.log(\"查看上一次的索引:\",proKeys)\n                // console.log(\"查看这一次的索引:\",keys)\n                // console.log(index,second,this.plans,this.plans[index - 1],this.plans[index][second])\n                // console.log(index,second,this.plans,this.plans[index - 1],this.plans[index - 1][second])\n                // console.log(\"匹配----------第\"+index+\"行,字段：\"+second+\"\",\"开头匹配\"+proKeys.startsWith(keys),\"是否合并\"+(this.data[index][second]===this.data[index-1][second]))\n                if (this.plans[index][second].name === this.plans[index - 1][second].name && proKeys.startsWith(keys)) {\n                  for (let i = index; i > 0; i--) {\n                    if (this.spanArr[i - 1][second] != 0) {\n                      this.spanArr[i - 1][second] += 1;\n                      break;\n                    }\n                  }\n                  this.spanArr[index][second] = 0;\n                } else {\n                  this.spanArr[index][second] = 1;\n                }\n              }\n            })\n            proKeys = keys;\n            // console.log(\"更新索引:\"+proKeys)\n          }\n        })\n      },\n      spanMethod({row, column, rowIndex, columnIndex}) {\n        let _row = this.spanArr[Number.parseInt(rowIndex)][column.property];\n        if (column.property == \"menu\"){\n          _row = 1;\n        }\n        const _col = _row > 0 ? 1 : 0;\n        return {\n          rowspan: _row,\n          colspan: _col\n        }\n      },\n      cellStyle({row, column, rowIndex, columnIndex}) {\n        if (column.property && (\n          column.property.startsWith(\"packageName\")\n          || column.property.startsWith(\"specification\")\n          || column.property.startsWith(\"websitePrice\")\n          || column.property.startsWith(\"miniLease\")\n          || column.property.startsWith(\"rentMoney\")\n          || column.property.startsWith(\"buyoutMoney\")\n          || column.property.startsWith(\"lateFeeMoney\")\n          || !row.$cellEdit)) {\n          return {\n            backgroundColor: '#FaFaFa',\n          }\n        }\n        if (column.property &&  column.property.startsWith(\"stockout\")) {\n          var txt = \"clip\";\n          return {\n            textOverflow:txt\n          }\n        }\n      },\n      headerClassName({row, column, rowIndex, columnIndex}) {\n        return \"head-class\"\n      },\n      cellClassName({row, column, rowIndex, columnIndex}) {\n        if (!row.$cellEdit&&column.property.startsWith(\"stockout\")){\n          return \"table-cell-class\"\n        }\n        return \"\"\n      },\n      handleRemove(file, fileList, type) {\n        this.sales[type] = this.sales[type].filter(item => {\n          console.log(item,file)\n          return item != file.name;\n        });\n        console.log(file.name)\n        console.log(JSON.stringify(this.photoCover),JSON.stringify(this.photoSlideshow))\n\n        this.photoSlideshow = this.photoSlideshow.filter(item => {\n          return item.name != file.name;\n        });\n\n        this.photoDetails = this.photoDetails.filter(item => {\n          return item.name != file.name;\n        });\n\n        this.photoCover = this.photoCover.filter(item => {\n          return item.name != file.name;\n        });\n\n        console.log(this.photoSlideshow,this.photoDetails,this.photoCover)\n      },\n      changePictureUpload(file,fileList){\n        this.uploadDisabled = fileList.length >= 1;\n      },\n      changeUpload(file,fileList, type){\n      },\n      onSuccessPhoto(res, file, type){\n        this.sales[type].push(res.data.name)\n      },\n      handlePictureCardPreview(file, type) {\n        console.log(file, type)\n        this.images[type].url = file.url;\n        this.images[type].isShow = true;\n      },\n      getDictionary(key) {\n        dictionary(key).then(res => {\n          if (key == \"network\")\n            this.newWorks = res.data.data\n          if (key == \"goods_hand\")\n            this.hands = res.data.data\n        });\n      },\n      getExtraService(key) {\n        dictionary(key).then(res => {\n          if (key == \"network\")\n            this.newWorks = res.data.data\n          if (key == \"goods_hand\")\n            this.hands = res.data.data\n        });\n      },\n      //获取分类\n      getCategory(parentId) {\n        if (parentId == 0) {\n          this.sales.levelFirstCategoryId = ''\n          this.levelSecondCategoryId = ''\n        } else {\n          this.sales.levelSecondCategoryId = ''\n        }\n        getList(0, 100, {parentId: parentId}).then(res => {\n          if (parentId == 0) {\n            this.levelFirstCategoryId = res.data.data\n          } else {\n            this.levelSecondCategoryId = res.data.data\n          }\n        })\n      },\n      referTags(data, select) {\n        for (let i = 0; i < data.length; i++) {\n          if (data[i].tags.length > 0 && data[i].id == select) {\n            Array.prototype.push.apply(this.sales.tags, data[i].tags.split(\",\"));\n          }\n        }\n      },\n      handlePreview(file) {\n        console.log(file);\n      },\n      // 保存，上架，下架，草稿\n      saveGoods(type){\n        if (type == -1){\n          this.$EventBus.$emit('tag', {\n            action:\"remove\",\n            value:\"/goods/add/index\",\n            isOpenTag:true,\n            isMatchAll:false\n          })\n          return;\n        }\n        // this.loading = true;\n        console.log(this.sales)\n\n\n\n        if (this.sales.planInfo.type_3&&Number.parseFloat(this.sales.planInfo.type_3.buyoutBalancePayment)<100){\n          Message({\n            message: \"买断尾款最少为100元\",\n            type: 'error'\n          })\n          return;\n        }\n\n        var data = JSON.stringify(this.sales);\n        console.log(data)\n        data = data.replace(/\\t|\\n|\\v|\\r|\\f/g,'').replace(/\\r\\n/g,'').replace(/\\n/g,'');\n        console.log(data)\n        let obj2 = JSON.parse(data)\n        var specifications = obj2.specifications;\n        obj2.specifications = [];\n        for (const specification of specifications) {\n          obj2.specifications.push(JSON.stringify(specification))\n        }\n        obj2.plans = [];\n        for (const plan of this.plans) {\n          obj2.plans.push(JSON.stringify(plan))\n        }\n        obj2.status = type;\n\n        console.log(obj2)\n\n        saveOrUpdate(obj2).then(response => {\n          this.loading = false;\n          this.$EventBus.$emit('tag', {\n            action:\"remove\",\n            value:\"/goods/add/index\",\n            isOpenTag:true,\n            isMatchAll:false\n          })\n        });\n      }\n    },\n    computed: {\n      isEdit(){\n        for (const plan of this.plans) {\n          if (plan.add){\n            return true;\n          }\n        }\n        return false;\n      },\n      headers(){\n        return headers()\n      },\n      option: function (){\n        var option = {\n          rowKey:'rowKey',\n          addBtn: false,\n          searchBtn: false,\n          border: true,\n          filterBtn: false,\n          refreshBtn: false,\n          columnBtn: false,\n          editBtn:false,\n          addRowBtn:false,\n          cellBtn:false,\n          cancelBtn:false,\n          headerAlign: 'center',\n          align: 'center',\n          menu:false,\n          column: []\n        }\n        option.column.push( {width: 100,label: '套餐',prop: 'packageName',cell: true,slot: true,})\n        var number = 0;\n        for (let index in this.sales.specifications) {\n          var item = this.sales.specifications[index]\n          if (item.name&&item.name.length>0&&item.isGroup == true){\n            option.column.push( { label: item.name, prop: 'specification'+(number+1), slot: true, cell: true })\n            number = number+1;\n          }\n        }\n        option.column.push( { label: '缺货', width: 60, prop: 'stockout', type: 'switch', cell: true })\n        option.column.push( { label: '库存(件)', width: 100, prop: 'inventory', cell: true, rules: [ { required: true, message: '请输入库存', trigger: 'blur' } ] })\n        option.column.push( { label: '官网价', width: 60, prop: 'websitePrice', slot: true, })\n        option.column.push( { label: '溢价金', prop: 'premiumMoney', cell: true, rules: [ { required: true, message: '请输入姓名', trigger: 'blur' } ] })\n        option.column.push( { label: '租金系数', prop: 'rentRate'})\n//        option.column.push( { label: '押金', prop: 'depositMoney', cell: true, rules: [ { required: true, message: '请输入姓名', trigger: 'blur' } ] })\n        option.column.push( { label: '最低月数', width: 70, prop: 'miniLease', slot: true, })\n        option.column.push( { label: '单期租金', width: 70, prop: 'rentMoney', slot: true, })\n        option.column.push( { label: '买断尾款', width: 70, prop: 'buyoutMoney', slot: true, })\n        option.column.push( { label: '滞纳金(日租金%)', width: 120, prop: 'lateFeeMoney', slot: true, })\n        option.column.push( { label: '操作', width: 100, prop: 'menu', slot: true, })\n        return option\n      },\n      cycleTotal: function () {\n        this.cycle01 = this.checkNum(this.cycle01, 1, 31)\n        this.cycle02 = this.checkNum(this.cycle02, 1, 31)\n        return this.cycle01 + '-' + this.cycle02;\n      },\n    },\n    mounted() {\n      const handler = ()=> this.handler()\n      Object.keys(this.sales)\n        .filter(_ => ![\"levelFirstCategoryId\", \"levelSecondCategoryId\", \"title\", \"marketing\",\"secondHand\",\"inputVisible\",\"inputValue\",\"photoDetails\",\"photoSlideshow\",\"photoCover\",\n          \"tags\",\"extraService\",\"marketingCornerMark\",\"returnAddressId\",\"leaseExplainId\",\"afterSaleId\"].includes(_)) // 排除对属性的监听\n        .forEach((_) => {\n          this.$watch(vm => vm.sales[_], handler, {\n            deep: true,\n            immediate: false\n          });\n        });\n      console.log(\"mounted-----\")\n    },\n    created() {\n      this.loading = true;\n      this.id=this.$route.query.goodsId;\n      this.getDictionary(\"network\")\n      this.getDictionary(\"goods_hand\")\n      this.$router.$avueRouter.setTitle(\"编辑商品\")\n      if (this.id == null){\n        this.$router.$avueRouter.setTitle(\"新增商品\")\n        //说明是新增\n        this.sales.periodType = this.$enum.goodsPlanInfo.defaultCycle\n        this.sales.billingCycle = this.$enum.goodsPlanInfo.billing_cycle_month\n        this.rowspan()\n        this.planInfos.type_1 = this.$enum.defaultPlanInfo.type_1\n        this.sales.planInfo.type_1.rentRate = this.planInfos.type_1.rentRate\n        this.sales.planInfo.type_1.typeTitle = this.planInfos.type_1.typeTitle\n        this.sales.planInfo.type_1.lateFeeRate = this.planInfos.type_1.lateFeeRate\n        this.sales.planInfo.type_1.renewalRate = this.planInfos.type_1.renewalRate\n\n        console.log(\"设置默认参数\")\n        // this.planInfos.type_2 = this.$enum.defaultPlanInfo.type_2\n        // this.sales.planInfo.type_2.rentRate = this.planInfos.type_2.rentRate\n        // this.sales.planInfo.type_2.lateFeeRate = this.planInfos.type_2.lateFeeRate\n\n        this.planInfos.type_3 = this.$enum.defaultPlanInfo.type_3\n        this.sales.planInfo.type_3.typeTitle = this.planInfos.type_3.typeTitle\n        this.sales.planInfo.type_3.rentRate = this.planInfos.type_3.rentRate\n        this.sales.planInfo.type_3.lateFeeRate = this.planInfos.type_3.lateFeeRate\n\n        this.sales.totalPricesRate = this.$enum.goodsPlanInfo.defaultTotalPricesRate\n      }\n      this.getCategory(0)\n      getExtraserviceList(0, 100, {}).then(res => {\n        this.extraServices = res.data.data.records\n      })\n      getReturnAddressList(0, 100, {}).then(res => {\n        this.returnAddresses = res.data.data.records\n      })\n      getMaintaininfoList().then(res => {\n        this.mainTainInfos = res.data.data\n      })\n      getRentinfoList().then(res => {\n        this.rentinfos = res.data.data\n      })\n      console.log(this.sales.planInfo)\n\n      if (this.id != null){\n        console.log(\"-----\")\n        //说明是新增\n        getDetail(this.id).then(res => {\n          this.loading = false;\n          var goodsInfo = res.data.data;\n          goodsInfo.specifications = [];\n          try {\n            var obj = JSON.parse(goodsInfo.goodsSpecificationsJsonData);\n            if(typeof obj == 'object' && obj ){\n              goodsInfo.specifications = obj\n            }\n          }catch (e) {\n\n          }\n\n          var tags = goodsInfo.tags;\n          if (goodsInfo.photoCover)\n            this.sales.photoCover = goodsInfo.photoCover.split(\",\");\n          if (goodsInfo.photoDetails)\n            this.sales.photoDetails = goodsInfo.photoDetails.split(\",\");\n          if (goodsInfo.photoSlideshow)\n            this.sales.photoSlideshow = goodsInfo.photoSlideshow.split(\",\");\n          for (const photo of this.sales.photoCover) {\n            this.photoCover.push({name: photo, url: this.$store.state.common.cloudDomain+photo})\n          }\n          for (const photo of this.sales.photoDetails) {\n            this.photoDetails.push({name: photo, url: this.$store.state.common.cloudDomain+photo})\n          }\n          for (const photo of this.sales.photoSlideshow) {\n            this.photoSlideshow.push({name: photo, url: this.$store.state.common.cloudDomain+photo})\n          }\n\n          this.sales.levelFirstCategoryId = goodsInfo.levelFirstCategoryId;\n          this.getCategory(this.sales.levelFirstCategoryId)\n          this.$nextTick(() => {\n            // DOM更新了\n            this.sales.levelSecondCategoryId = goodsInfo.levelSecondCategoryId;\n            this.$nextTick(() => {\n              this.sales.tags = []\n              this.sales.tags = goodsInfo.category.split(\",\");\n            })\n\n          })\n          this.sales.id = goodsInfo.id;\n          this.sales.limitUser = goodsInfo.limitUser;\n          this.sales.title = goodsInfo.title;\n          this.sales.marketing = goodsInfo.marketing;\n          this.sales.oldNew = goodsInfo.secondHand == 100?\"0\":\"1\";\n          this.sales.secondHand = goodsInfo.secondHand;\n          this.sales.marketingCornerMark = goodsInfo.marketingCornerMark;\n          this.sales.extraService = goodsInfo.extraService.split(\",\")\n          this.sales.returnAddressId = goodsInfo.returnAddressId;\n          this.sales.expressFree = goodsInfo.expressFree;\n          this.sales.expressPrice = goodsInfo.expressPrice\n          this.sales.leaseExplainId = Number.parseInt(goodsInfo.leaseExplainId);\n          this.sales.afterSaleId = Number.parseInt(goodsInfo.afterSaleId);\n          this.sales.periodType = goodsInfo.periodType+\"\";\n          this.sales.billingCycle = goodsInfo.billingCycle;\n          this.sales.totalPricesRate = goodsInfo.totalPricesRate;\n          this.sales.specifications = goodsInfo.specifications\n          this.$nextTick(() => {\n            if(goodsInfo.planInfo.type_1){\n              goodsInfo.planInfo.type_1.rentType = true;\n              Object.assign(this.sales.planInfo.type_1,goodsInfo.planInfo.type_1)\n              this.sales.planInfo.type_1.rentType = true;\n            }else{\n              this.sales.planInfo.type_1.rentType = false;\n            }\n            this.sales.planInfo.type_1.lateFeeRate = 0.2;\n            // if(goodsInfo.planInfo.type_2){\n            //   Object.assign(this.sales.planInfo.type_2,goodsInfo.planInfo.type_2)\n            //   this.sales.planInfo.type_2.rentType = true;\n            // }else{\n            //   this.sales.planInfo.type_2.rentType = false;\n            // }\n            if(goodsInfo.planInfo.type_3){\n              Object.assign(this.sales.planInfo.type_3,goodsInfo.planInfo.type_3)\n              this.sales.planInfo.type_3.rentType = true;\n            }else{\n              this.sales.planInfo.type_3.rentType = false;\n            }\n            this.sales.planInfo.type_3.lateFeeRate = 0.2;\n            console.log(\"赋值\",this.plans)\n          })\n          this.plans = JSON.parse(goodsInfo.combinationsJsonData)\n          //更新下拉\n          this.rowspan()\n          this.table_key = new Date().getTime();\n        });\n      }else{\n        this.loading = false;\n      }\n    }\n  };\n",{"version":3,"sources":["goods_add.vue"],"names":[],"mappings":";AAieA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"goods_add.vue","sourceRoot":"src/views/goods","sourcesContent":["<template>\n  <div style=\"height: 100%;\">\n    <div v-loading=\"loading\" style=\"height:100%;width:100%;z-index: 100;position: absolute\" v-if=\"loading\"></div>\n    <div>\n      <el-form ref=\"form1\" :model=\"sales\" label-width=\"120px\" :rules=\"rules\" size=\"small\">\n        <div class=\"top-bar-title top\">\n          <div style=\"line-height: 30px;text-align: center;\">\n            新增商品\n          </div>\n          <div>\n            <el-button plain @click=\"saveGoods(-1)\" size=\"mini\">返回</el-button>\n            <el-button type=\"primary\" @click=\"saveGoods(0)\" size=\"mini\" plain>保存</el-button>\n            <el-button type=\"warning\" @click=\"saveGoods(1)\" size=\"mini\" plain>上架</el-button>\n            <el-button type=\"info\" @click=\"saveGoods(2)\" size=\"mini\" plain>下架</el-button>\n            <el-button type=\"info\" @click=\"saveGoods(3)\" size=\"mini\" plain>草稿</el-button>\n          </div>\n        </div>\n        <div>\n          <el-card class=\"basis-info\" style=\"margin-top: 56px;\">\n            <div slot=\"header\" class=\"clearfix\">\n              <span>基础信息</span>\n            </div>\n            <div class=\"form-view\">\n              <div style=\"width: 1000px;\">\n                <el-row>\n                  <el-col :span=\"12\">\n                    <el-form-item label=\"一级类目：\" prop=\"levelFirstCategoryId\">\n                      <el-select v-model=\"sales.levelFirstCategoryId\" placeholder=\"请选择类目\">\n                        <el-option :label=\"category.name\" v-for=\"category in this.levelFirstCategoryId\" :value=\"category.id\"></el-option>\n                      </el-select>\n                    </el-form-item>\n                  </el-col>\n                  <el-col :span=\"12\">\n                    <el-form-item label=\"二级类目：\" prop=\"levelSecondCategoryId\">\n                      <el-select v-model=\"sales.levelSecondCategoryId\" placeholder=\"请选择类目\">\n                        <el-option :label=\"category.name\" v-for=\"category in this.levelSecondCategoryId\" :value=\"category.id\"></el-option>\n                      </el-select>\n                    </el-form-item>\n                  </el-col>\n                </el-row>\n                <el-row>\n                  <el-col :span=\"24\">\n                    <el-form-item label=\"商品标题：\" prop=\"title\">\n                      <el-input v-model=\"sales.title\"></el-input>\n                    </el-form-item>\n                  </el-col>\n                  <el-col :span=\"0\">\n                    <el-form-item label=\"网络类型：\" prop=\"phonenumber\">\n                      <el-select v-model=\"sales.network\" placeholder=\"请选择网络类型\">\n                        <el-option :label=\"network.dictValue\" v-for=\"network in this.newWorks\"\n                                   :value=\"network.dictKey\"></el-option>\n                      </el-select>\n                    </el-form-item>\n                  </el-col>\n                </el-row>\n                <el-form-item label=\"营销语句：\">\n                  <el-input v-model=\"sales.marketing\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"商品成色：\">\n                  <el-radio-group v-model=\"sales.oldNew\">\n                    <el-radio label=\"0\">全新</el-radio>\n                    <el-radio label=\"1\">二手</el-radio>\n                  </el-radio-group>\n                  <span style=\"margin-left: 20px\">成色</span>\n                  <el-select v-model=\"sales.secondHand\" placeholder=\"请选择成色\" style=\"width: auto;margin-left: 10px\"\n                             :disabled=\"sales.oldNew=='0'\">\n                    <el-option :label=\"hand.dictValue\" v-for=\"hand in this.hands\" :value=\"hand.dictKey\"></el-option>\n                  </el-select>\n                  <span style=\"margin-left: 20px\">折扣率{{ sales.secondHand }}%</span>\n                </el-form-item>\n\n                <el-form-item label=\"类目标签：\">\n                  <el-tag\n                    :key=\"tag\"\n                    v-for=\"tag in sales.tags\"\n                    closable\n                    :disable-transitions=\"false\"\n                    @close=\"handleClose(tag)\">\n                    {{ tag }}\n                  </el-tag>\n                  <el-input\n                    class=\"input-new-tag\"\n                    v-if=\"sales.inputVisible\"\n                    v-model=\"sales.inputValue\"\n                    ref=\"saveTagInput\"\n                    size=\"small\"\n                    @keyup.enter.native=\"handleInputConfirm\"\n                    @blur=\"handleInputConfirm\"\n                  >\n                  </el-input>\n                  <el-button v-else class=\"button-new-tag\" size=\"small\" @click=\"showInput\">+ 自定义标签</el-button>\n                </el-form-item>\n                <el-form-item label=\"营销角标：\">\n                  <el-input v-model=\"sales.marketingCornerMark\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"增值服务：\">\n                  <el-select v-model=\"sales.extraService\" multiple placeholder=\"请选择\">\n                    <el-option\n                      v-for=\"item in extraServices\"\n                      :key=\"item.id\"\n                      :label=\"item.name\"\n                      :value=\"item.id\">\n                    </el-option>\n                  </el-select>\n                </el-form-item>\n                <el-form-item label=\"归还地址：\" prop=\"returnAddressId\">\n                  <el-select v-model=\"sales.returnAddressId\" placeholder=\"请选择归还地址\">\n                    <el-option :label=\"address.name+' '+address.phone+' '+address.address\"\n                               v-for=\"address in this.returnAddresses\" :value=\"address.id\"></el-option>\n                  </el-select>\n                </el-form-item>\n                <el-form-item label=\"租赁说明：\" prop=\"leaseExplainId\">\n                  <el-select v-model=\"sales.leaseExplainId\" placeholder=\"请选择租赁说明\">\n                    <el-option :label=\"rentinfo.name\" v-for=\"rentinfo in this.rentinfos\" :value=\"rentinfo.id\"></el-option>\n                  </el-select>\n                </el-form-item>\n                <el-form-item label=\"售后维修说明：\" prop=\"afterSaleId\">\n                  <el-select v-model=\"sales.afterSaleId\" placeholder=\"请选择售后维修说明\">\n                    <el-option :label=\"mainTinInfo.name\" v-for=\"mainTinInfo in this.mainTainInfos\"\n                               :value=\"mainTinInfo.id\"></el-option>\n                  </el-select>\n                </el-form-item>\n                <el-row>\n                  <el-col :span=\"12\">\n                    <el-form-item label=\"是否包邮：\" prop=\"expressFree\">\n                      <el-select v-model=\"sales.expressFree\" placeholder=\"请选择是否包邮\">\n                        <el-option :label=\"express.label\" v-for=\"express in this.expressList\"\n                                   :value=\"express.value\"></el-option>\n                      </el-select>\n                    </el-form-item>\n                  </el-col>\n                  <el-col :span=\"12\">\n                    <el-form-item label=\"邮费：\" :span=\"12\" prop=\"expressPrice\">\n                      <el-input v-model=\"sales.expressPrice\"></el-input>\n                    </el-form-item>\n                  </el-col>\n                </el-row>\n                <el-form-item label=\"指定用户可见：\">\n                  <el-input v-model=\"sales.limitUser\" placeholder=\"输入手机号（多个英文逗号隔开），即可指定该商品只有这个手机号可见\"></el-input>\n                </el-form-item>\n              </div>\n            </div>\n          </el-card>\n          <el-card class=\"basis-info\">\n            <div slot=\"header\" class=\"clearfix\">\n              <span>销售信息</span>\n            </div>\n            <div class=\"form-view\">\n              <div style=\"width: 1000px;\">\n                <el-form-item label=\"期数单位：\">\n                  <div style=\"display: inline-block;\" class=\"has-background\">\n                    <div class=\"has-background-item\">\n                      <el-radio-group v-model=\"sales.periodType\">\n                        <el-radio label=\"2\">以月为单位</el-radio>\n<!--                        <el-radio label=\"1\">以日为单位</el-radio>-->\n                      </el-radio-group>\n<!--                      <span class=\"form-input-title\" >账单周期:</span>-->\n<!--                      <el-input v-model=\"sales.billingCycle\" style=\"width: 200px\" :disabled=\"sales.periodType == 2\"  type=\"number\"></el-input>-->\n<!--                      <span class=\"form-input-title\" >{{ sales.periodType == 1?\"天\":\"月\" }}</span>-->\n                    </div>\n                    <div>\n                 <span style=\"margin-left: 20px\">\n                 当以月为周期，则账单扣款以及生成都以月为单位\n<!--                   ，当以周为周期，账单的扣款和生成都以周为单位-->\n                 </span>\n                    </div>\n                  </div>\n                </el-form-item>\n\n                <el-form-item label=\"总价系数：\">\n                  <div style=\"display: inline-block\" class=\"has-background\">\n                    <el-input v-model=\"sales.totalPricesRate\"></el-input>\n                    <span>\n               总金额不能超过商品市场价格的150%\n             </span>\n                  </div>\n                </el-form-item>\n                <el-form-item label=\"方案：\">\n                  <div style=\"display: inline-block\" class=\"has-background\">\n                    <div class=\"has-background-item\"></div>\n                    <div v-for=\"(value,key) in planInfos\">\n                      <div class=\"has-background-item\" style=\"display: block\">\n                        <div style=\"display: inline;margin-top: 10px\">\n                          <el-checkbox v-model=\"sales.planInfo[key].rentType\" label=\"type_1\">{{ value.typeName}}</el-checkbox>\n                          <span class=\"form-input-title\">租金系数:</span>\n                          <el-input class=\"form-input-3\" v-model=\"sales.planInfo[key].rentRate\"  type=\"number\"></el-input>\n                          <span class=\"form-input-title\">日滞纳金系数:</span>\n                          <el-input disabled=\"true\" class=\"form-input-3\" v-model=\"sales.planInfo[key].lateFeeRate\"  type=\"number\"></el-input>\n                          <span class=\"form-input-title\" v-if=\"value.type == 1\">续租系数:</span>\n                          <el-input class=\"form-input-3\" v-model=\"sales.planInfo[key].renewalRate\" type=\"number\"\n                                    v-if=\"value.type == 1\"></el-input>\n                          <span class=\"form-input-title\" v-if=\"value.type == 3\">买断尾款:</span>\n                          <el-input class=\"form-input-3\" v-model=\"sales.planInfo[key].buyoutBalancePayment\"  type=\"number\"\n                                    v-if=\"value.type == 3\"></el-input>\n                        </div>\n                        <div>\n                  <span class=\"form-plan-notice\">\n               {{ value.typeInfo }}\n                </span>\n                          <div style=\"display: flex;margin-bottom: 10px;\">\n                            <span class=\"form-input-title\">套餐说明:</span>\n                            <el-input class=\"form-input-3\" style=\"flex: 1\" v-model=\"sales.planInfo[key].typeTitle\"  ></el-input>\n                            <span class=\"form-input-title\">展示在手机端套餐的名称</span>\n                          </div>\n                          <div>\n                            <span class=\"form-input-title\">最低租期:</span>\n                            <el-select v-model=\"sales.planInfo[key].miniLease\" class=\"form-select-2\" placeholder=\"请选择租期\">\n                              <el-option :label=\"(sales.periodType == 1?(item+'天'):(item<12?(item+'月'):(item/12+'年')))\" :value=\"item\" v-for=\"item in value.miniLeaseList[sales.periodType-1]\"></el-option>\n                            </el-select>\n                            <span class=\"form-input-title\">最高租期:</span>\n                            <el-select v-model=\"sales.planInfo[key].maxLease\" class=\"form-select-2\" placeholder=\"请选择租期\">\n                              <el-option :label=\"(sales.periodType == 1?(item+'天'):(item<12?(item+'月'):(item/12+'年')))\" :value=\"item\" v-for=\"item in getMaxList(value,key)\">\n                              </el-option>\n                            </el-select>\n                          </div>\n                        </div>\n                      </div>\n                      <div style=\"height: 10px;width: 100%;background-color: #FFFFFF\"></div>\n                    </div>\n                  </div>\n                </el-form-item>\n                <el-form-item label=\"产品规格：\" v-for=\"(item,index) in sales.specifications\">\n                  <div style=\"display: inline-block;padding-left: 0px !important;\" class=\"no-background\">\n                    <div style=\"display: inline\">\n                      <el-input v-model=\"item.name\" style=\"width: calc(100% - 198px);\"></el-input>\n                      <el-checkbox label=\"是否组合\" style=\"width: 70px;margin-left: 10px;margin-right: 10px\" v-model=\"item.isGroup\"></el-checkbox>\n                      <el-button  type=\"danger\" icon=\"el-icon-delete\" style=\"margin-left: 10px\" v-if=\"index!=0\" @click=\"deSpecification(sales.specifications,index)\">删除规格</el-button>\n                    </div>\n                    <div>\n                <span>\n                 规格名称 例如：“颜色”、“尺寸”等。选中组合后，会自动在方案详情中生成组合项\n               </span>\n                    </div>\n                    <!--                  <el-checkbox label=\"是否上传图片\" v-model=\"item.isUploadPhoto\"></el-checkbox>-->\n                  </div>\n                  <div>\n                    <span>请添加自定义规格属性</span>\n                  </div>\n                  <div style=\"display: block;padding: 20px 10px 20px 10px;text-align: center\" class=\"has-background\" >\n                    <div style=\"display: block;\" v-for=\"(one,n) in item.attr\">\n                      <el-row>\n                        <el-col :span=\"14\" style=\"padding: 10px 5px\">\n                          <el-input placeholder=\"输入自定义规格\" v-model=\"one.name\"></el-input>\n                        </el-col>\n                        <el-col :span=\"4\" style=\"padding: 10px 5px\" v-if=\"index==0\">\n                          <el-input placeholder=\"输入官网价\" v-model=\"one.websitePrice\"  type=\"number\"></el-input>\n                        </el-col>\n                        <el-col :span=\"4\" style=\"padding: 10px 5px\" v-if=\"index==0\">\n                          <el-input placeholder=\"输入续租价\" v-model=\"one.renewalPrice\"  type=\"number\"></el-input>\n                        </el-col>\n                        <el-col :span=\"2\" style=\"padding: 10px 5px\" v-if=\"n!=0\">\n                          <el-button type=\"text\" @click=\"deAttr(item.attr,n)\">-移除属性</el-button>\n                        </el-col>\n                      </el-row>\n                      <div v-if=\"item.isUploadPhoto == true\">\n                        <el-upload\n                          :class=\"{disabled: uploadDisabled,small:true}\"\n                          style=\"text-align: left\"\n                          action=\"https://jsonplaceholder.typicode.com/posts/\"\n                          list-type=\"picture-card\"\n                          :on-change=\"changePictureUpload\"\n                          :on-preview=\"handlePictureCardPreview\"\n                          :on-remove=\"handleRemove\">\n                          <i class=\"el-icon-plus\"></i>\n                        </el-upload>\n                        <el-dialog :visible.sync=\"dialogVisible\">\n                          <img width=\"20%\" :src=\"dialogImageUrl\" alt=\"\">\n                        </el-dialog>\n                      </div>\n                    </div>\n                    <el-button type=\"primary\" icon=\"el-icon-plus\" @click=\"addAttr(item)\">新增属性</el-button>\n                  </div>\n                </el-form-item>\n                <el-form-item label=\"\" style=\"text-align: center\">\n                  <el-button type=\"primary\" icon=\"el-icon-plus\" @click=\"addCombination\">新增产品规格</el-button>\n                </el-form-item>\n              </div>\n            </div>\n          </el-card>\n          <el-card class=\"basis-info\">\n            <div slot=\"header\" class=\"clearfix\">\n              <span>方案详情</span><span style=\"color: #D9001B\">(说明：表格灰色部分为不可修改，数据自动生成，白色背景的单元格为可编辑单元格)</span>\n            </div>\n            <avue-crud :key=\"table_key\" ref=\"crud\" :option=\"option\" :data=\"plans\" :cell-style=\"cellStyle\"\n                       :header-cell-class-name=\"headerClassName\" :span-method=\"spanMethod\"\n                       @row-click=\"handleRowClick\" :cell-class-name=\"cellClassName\">\n              <template slot=\"packageName\" slot-scope=\"scope\">\n                <el-tag>{{ scope.label.name }}</el-tag>\n              </template>\n              <template slot=\"packageNameForm\" slot-scope=\"{row,disabled}\">\n                <el-select v-model=\"row.packageName.name\" placeholder=\"请选择\" v-if=\"row.add\" size=\"mini\">\n                  <el-option\n                    v-for=\"(value,key) in sales.planInfo\"\n                    v-if=\"value.rentType\"\n                    @click.native=\"changePackageName(value,row)\"\n                    :key=\"value.name\"\n                    :label=\"value.name\"\n                    :value=\"value.name\">\n                  </el-option>\n                </el-select>\n                <el-tag :disabled=\"!row.add\">{{ row.packageName.name }}</el-tag>\n              </template>\n              <!--        规格名称-->\n              <template slot=\"specification1\" slot-scope=\"scope\">\n                <el-tag>{{ scope.label.name }}</el-tag>\n              </template>\n              <template slot=\"specification1Form\" slot-scope=\"{row,disabled}\">\n                <!--              <span v-if=\"row.add\">{{ sales.specifications[0]}}</span>-->\n                <el-select v-model=\"row.specification1.name\" placeholder=\"请选择\" v-if=\"row.add\" size=\"mini\">\n                  <el-option\n                    v-for=\"(item, index) in sales.specifications[0].attr\"\n                    @click.native =\"changeSpecification(sales.specifications[0],sales.specifications[0].attr[index],row.specification1)\"\n                    :key=\"item.name\"\n                    :label=\"item.name\"\n                    :value=\"item.name\">\n                  </el-option>\n                </el-select>\n                <el-tag v-else>{{ row.specification1?row.specification1.name:\"\"}}</el-tag>\n              </template>\n              <!--        规格名称-->\n              <template slot=\"specification2\" slot-scope=\"scope\">\n                <el-tag>{{ scope.label.name }}</el-tag>\n              </template>\n              <template slot=\"specification2Form\" slot-scope=\"{row,disabled}\">\n                <!--              <span v-if=\"row.add\">{{ sales.specifications[1].attr}}</span>-->\n                <el-select v-model=\"row.specification2.name\" placeholder=\"请选择\" v-if=\"row.add\" size=\"mini\">\n                  <el-option\n                    v-for=\"(item, index) in  specifications[1].attr\"\n                    :key=\"index\"\n                    @click.native =\"changeSpecification(specifications[1],specifications[1].attr[index],row.specification2)\"\n                    :label=\"item.name\"\n                    :value=\"item.name\">\n                  </el-option>\n                </el-select>\n                <el-tag v-else>{{ row.specification2?row.specification2.name:\"\" }}</el-tag>\n              </template>\n              <!--        规格名称-->\n              <template slot=\"specification3\" slot-scope=\"scope\">\n                <el-tag>{{ scope.label.name }}</el-tag>\n              </template>\n              <template slot=\"specification3Form\" slot-scope=\"{row,disabled}\">\n                <el-select v-model=\"row.specification3.name\" placeholder=\"请选择\" v-if=\"row.add\" size=\"mini\">\n                  <el-option\n                    v-for=\"(item, index) in  specifications[2].attr\"\n                    :key=\"index\"\n                    @click.native =\"changeSpecification(specifications[2],specifications[2].attr[index],row.specification3)\"\n                    :label=\"item.name\"\n                    :value=\"item.name\">\n                  </el-option>\n                </el-select>\n                <el-tag v-else>{{ row.specification3?row.specification3.name:\"\" }}</el-tag>\n              </template>\n              <!--        规格名称-->\n              <template slot=\"specification4\" slot-scope=\"scope\">\n                <el-tag>{{ scope.label.name }}</el-tag>\n              </template>\n              <template slot=\"specification4Form\" slot-scope=\"{row,disabled}\">\n                <el-select v-model=\"row.specification4.name\" placeholder=\"请选择\" v-if=\"row.add\" size=\"mini\">\n                  <el-option\n                    v-for=\"(item, index) in  specifications[3].attr\"\n                    :key=\"index\"\n                    @click.native =\"changeSpecification(specifications[3],specifications[3].attr[index],row.specification4)\"\n                    :label=\"item.name\"\n                    :value=\"item.name\">\n                  </el-option>\n                </el-select>\n                <el-tag v-else>{{ row.specification4?row.specification4.name:\"\" }}</el-tag>\n              </template>\n              <!--        规格名称-->\n              <template slot=\"specification5\" slot-scope=\"scope\">\n                <el-tag>{{ scope.label.name }}</el-tag>\n              </template>\n              <template slot=\"specification5Form\" slot-scope=\"{row,disabled}\">\n                <el-select v-model=\"row.specification5.name\" placeholder=\"请选择\" v-if=\"row.add\" size=\"mini\">\n                  <el-option\n                    v-for=\"(item, index) in  specifications[4].attr\"\n                    :key=\"index\"\n                    @click.native =\"changeSpecification(specifications[4],specifications[4].attr[index],row.specification5)\"\n                    :label=\"item.name\"\n                    :value=\"item.name\">\n                  </el-option>\n                </el-select>\n                <el-tag v-else>{{ row.specification5?row.specification5.name:\"\" }}</el-tag>\n              </template>\n              <!--        官网价-->\n              <template slot=\"websitePrice\" slot-scope=\"scope\">\n                <span>{{ scope.label }}</span>\n              </template>\n              <!--        最低租期-->\n              <template slot=\"miniLease\" slot-scope=\"scope\">\n                <span>{{ scope.label }}</span>\n              </template>\n              <!--        每一期租金-->\n              <template slot=\"rentMoney\" slot-scope=\"scope\">\n                <span>{{ calculateRentMoney(scope.row) }}</span>\n              </template>\n              <!--        买断尾款-->\n              <template slot=\"buyoutMoney\" slot-scope=\"scope\">\n                <span>{{ calculateBuyoutMoney(scope.row) }}</span>\n              </template>\n              <!--        滞纳金-->\n              <template slot=\"lateFeeMoney\" slot-scope=\"scope\">\n                <span>{{ calculateLateFeeMoney(scope.row) }}</span>\n              </template>\n              <template slot=\"stockout\" slot-scope=\"scope\">\n                <el-switch\n                  v-model=\"scope.label\" v-if=\"scope.label\" @change=\"changeStockout(scope)\" class=\"orther\">\n                </el-switch>\n              </template>\n              <template slot-scope=\"{type,size,row,index}\" slot=\"menu\">\n                <el-button icon=\"el-icon-close\" :size=\"size\" :type=\"type\" @click=\"deleteRow(index)\">删除</el-button>\n              </template>\n            </avue-crud>\n            <div style=\"text-align: center;margin-top: 10px\">\n              <el-button type=\"primary\" icon=\"el-icon-save\" @click=\"savePlan\" v-if=\"isEdit\">保存方案</el-button>\n              <el-button type=\"primary\" icon=\"el-icon-plus\" @click=\"addPlan\" v-if=\"!isEdit\">增加一条方案</el-button>\n            </div>\n          </el-card>\n          <el-card class=\"basis-info\">\n            <div slot=\"header\" class=\"clearfix\">\n              <span>商品信息</span>\n            </div>\n            <div>\n              <el-form-item label=\"上传封面图片：\">\n                <el-upload\n                  action=\"/api/blade-resource/oss/endpoint/put-file\"\n                  list-type=\"picture-card\"\n                  :headers=\"headers\"\n                  :class=\"{ hide: photoCover.length>0 }\"\n                  :limit=\"1\"\n                  :file-list=\"photoCover\"\n                  :on-preview=\"function (file){return handlePictureCardPreview(file, 'photoCover')}\"\n                  :on-success=\"function (res, file){return onSuccessPhoto(res, file, 'photoCover')}\"\n                  :on-remove=\"function (file,fileList){return handleRemove(file,fileList, 'photoCover')}\">\n                  <i class=\"el-icon-plus\" v-if=\"photoCover.length == 0\"></i>\n                </el-upload>\n                <el-dialog :visible.sync=\"images.photoCover.isShow\">\n                  <img width=\"100%\" :src=\"images.photoCover.url\" alt=\"\">\n                </el-dialog>\n              </el-form-item>\n              <el-form-item label=\"上传轮播图片：\">\n                <el-upload\n                  action=\"/api/blade-resource/oss/endpoint/put-file\"\n                  list-type=\"picture-card\"\n                  :headers=\"headers\"\n                  :class=\"{ hide: photoSlideshow>5 }\"\n                  :file-list=\"photoSlideshow\"\n                  :on-preview=\"function (file){return handlePictureCardPreview(file, 'photoSlideshow')}\"\n                  :on-success=\"function (res, file){return onSuccessPhoto(res, file, 'photoSlideshow')}\"\n                  :on-remove=\"function (file,fileList){return handleRemove(file,fileList, 'photoSlideshow')}\">\n                  <i class=\"el-icon-plus\"></i>\n                </el-upload>\n                <el-dialog :visible.sync=\"images.photoSlideshow.isShow\">\n                  <img width=\"100%\" :src=\"images.photoSlideshow.url\" alt=\"\">\n                </el-dialog>\n              </el-form-item>\n              <el-form-item label=\"上传详情图片：\">\n                <el-upload\n                  action=\"/api/blade-resource/oss/endpoint/put-file\"\n                  list-type=\"picture-card\"\n                  :class=\"{ hide: photoDetails>0 }\"\n                  :headers=\"headers\"\n                  :file-list=\"photoDetails\"\n                  :on-preview=\"function (file){return handlePictureCardPreview(file, 'photoDetails')}\"\n                  :on-success=\"function (res, file){return onSuccessPhoto(res, file, 'photoDetails')}\"\n                  :on-remove=\"function (file,fileList){return handleRemove(file,fileList, 'photoDetails')}\">\n                  <i class=\"el-icon-plus\"></i>\n                </el-upload>\n                <el-dialog :visible.sync=\"images.photoDetails.isShow\">\n                  <img width=\"100%\" :src=\"images.photoDetails.url\" alt=\"\">\n                </el-dialog>\n              </el-form-item>\n            </div>\n          </el-card>\n        </div>\n      </el-form>\n    </div>\n  </div>\n</template>\n\n<script>\n  import {categoryTree, getList} from \"../../api/goods/goodscategory\";\n  import {getDetail} from \"@/api/goods/goods\";\n  import {dictionary} from \"../../api/system/dict\";\n  import {getList as getExtraserviceList} from \"../../api/goods/extraservice\";\n  import {getList as getReturnAddressList} from \"../../api/goods/returnaddress\";\n  import {getAllList as getMaintaininfoList} from \"../../api/operation/maintaininfo\";\n  import {getAllList as getRentinfoList} from \"../../api/operation/rentinfo\";\n  import {Base64} from 'js-base64';\n  import {getToken, headers} from '../../util/auth'\n  import website from '../../config/website';\n  import {\n    calculateBuyoutMoney, calculateLateFeeMoney,\n    calculateRentMoney,\n    calculatePerRentMoney, floatObj,\n  } from \"../../constant/goods/constant\";\n  import {saveOrUpdate} from \"../../api/goods/goods\";\n  import func from \"../../util/func\";\n  import {Message} from 'element-ui'\n\n  export default {\n    name: \"wel\",\n    data() {\n      return {\n        table_key:0,\n        loading:false,\n        rules:{\n          levelFirstCategoryId: [\n            { required: true, message: '请请选择类目', trigger: 'blur' },\n          ],\n          levelSecondCategoryId: [\n            { required: true, message: '请请选择类目', trigger: 'blur' },\n          ],\n          title: [\n            { required: true, message: '请输入商品标题', trigger: 'blur' },\n          ],\n          returnAddressId: [\n            { required: true, message: '请选择归还地址', trigger: 'blur' },\n          ],\n          leaseExplainId: [\n            { required: true, message: '请选择租赁说明', trigger: 'blur' },\n          ],\n          afterSaleId: [\n            { required: true, message: '请选择售后维修说明', trigger: 'blur' },\n          ],\n          totalPricesRate: [\n            { required: true, message: '请输入总价系数', trigger: 'blur' },\n          ],\n          periodType: [\n            { required: true, message: '请选择租期', trigger: 'blur' },\n          ],\n          expressFree: [\n            { required: true, message: '请选择快递方式', trigger: 'blur' },\n          ],\n          expressPrice:[\n            { required: true, message: '请输入邮费', trigger: 'blur' },\n          ],\n        },\n        sales:{\n          deleteCombination:[],\n          deleteSpecification:[],\n          photoCover:[],\n          photoDetails:[],\n          photoSlideshow:[],\n          levelFirstCategoryId: '',\n          levelSecondCategoryId: '',\n          title: '',\n          network: '',\n          marketing: '',\n          oldNew: '0',\n          secondHand: '100',\n          marketingCornerMark: '',\n          extraService: [],\n          returnAddressId: '',\n          leaseExplainId: '',\n          afterSaleId: '',\n          expressFree:\"1\",\n          expressPrice:null,\n          limitUser:null,\n          totalPricesRate: 0,\n          tags: [],\n          inputVisible: false,\n          inputValue: '',\n          value1: [],\n          periodType: null,//期数单位\n          billingCycle: 0,//账单周期\n          specifications:[],\n          planInfo: {\n            type_1: {\n              type:1,\n              typeTitle: '月供低 年年焕新',\n              rentType:false,\n              rentRate: null,\n              lateFeeRate: null,\n              renewalRate: null,\n              miniLease: null,\n              name:null,\n              miniType: null,\n              maxLease: null,\n              maxType: null,\n              buyoutBalancePayment:null,\n            },\n            // type_2: {\n            //   type:2,\n            //   rentType:false,\n            //   rentRate: null,\n            //   lateFeeRate: null,\n            //   renewalRate: null,\n            //   miniLease: null,\n            //   name:null,\n            //   miniType: null,\n            //   maxLease: null,\n            //   maxType: null,\n            //   buyoutBalancePayment:null,\n            // },\n            type_3: {\n              type:3,\n              typeTitle: '个月内随时续租/买断/归还/续满即送',\n              rentType:false,\n              rentRate: null,\n              lateFeeRate: null,\n              renewalRate: null,\n              miniLease: null,\n              name:null,\n              miniType: null,\n              maxLease: null,\n              maxType: null,\n              buyoutBalancePayment:100,\n            },\n          },\n        },\n        specifications:[],\n        photoCover:[],\n        photoDetails:[],\n        photoSlideshow:[],\n        uploadDisabled:false,\n        id:null,\n        levelFirstCategoryId: [],\n        levelSecondCategoryId: [],\n        newWorks: [],\n        hands: [],\n        usePlan:0,\n        extraServices: [],\n        returnAddresses: [],\n        mainTainInfos: [],\n        expressList: [{\n          value: '1',\n          label: '包邮'\n        }, {\n          value: '2',\n          label: '不包邮'\n        }],\n        rentinfos: [],\n        planInfos: {\n          type_1:\n            {\n              type: 1,\n              typeName: this.$enum.defaultReturn.typeName,\n              typeInfo: this.$enum.defaultReturn.typeInfo,\n              rentRate: this.$enum.defaultReturn.rentRate,\n              lateFeeRate: this.$enum.defaultReturn.lateFeeRate,\n              renewalRate: this.$enum.defaultReturn.renewalRate,\n              miniLease: this.$enum.defaultReturn.miniLease,\n              miniType: this.$enum.defaultReturn.miniType,\n              maxLease: this.$enum.defaultReturn.maxLease,\n              maxType: this.$enum.defaultReturn.maxType,\n              miniLeaseList:this.$enum.defaultReturn.miniLeaseList,\n              maxLeaseList:this.$enum.defaultReturn.maxLeaseList,\n            },\n          // type_2: {\n          //   type: 2,\n          //   typeName: this.$enum.defaultBuyout.typeName,\n          //   typeInfo: this.$enum.defaultBuyout.typeInfo,\n          //   rentRate: this.$enum.defaultBuyout.rentRate,\n          //   lateFeeRate: this.$enum.defaultBuyout.lateFeeRate,\n          //   renewalRate: this.$enum.defaultBuyout.renewalRate,\n          //   miniLease: this.$enum.defaultBuyout.miniLease,\n          //   miniType: this.$enum.defaultBuyout.miniType,\n          //   maxLease: this.$enum.defaultBuyout.maxLease,\n          //   maxType: this.$enum.defaultBuyout.maxType,\n          //   miniLeaseList:this.$enum.defaultBuyout.miniLeaseList,\n          //   maxLeaseList:this.$enum.defaultBuyout.maxLeaseList,\n          // },\n          type_3: {\n            type: 3,\n            typeName: this.$enum.defaultFlexible.typeName,\n            typeInfo: this.$enum.defaultFlexible.typeInfo,\n            rentRate: this.$enum.defaultFlexible.rentRate,\n            lateFeeRate: this.$enum.defaultFlexible.lateFeeRate,\n            renewalRate: this.$enum.defaultFlexible.renewalRate,\n            miniLease: this.$enum.defaultFlexible.miniLease,\n            miniType: this.$enum.defaultFlexible.miniType,\n            maxLease: this.$enum.defaultFlexible.maxLease,\n            maxType: this.$enum.defaultFlexible.maxType,\n            miniLeaseList:this.$enum.defaultFlexible.miniLeaseList,\n            maxLeaseList:this.$enum.defaultFlexible.maxLeaseList,\n          }\n        },\n        images: {\n            photoCover:{\n              isShow:false,\n              url: '',\n            },\n            photoDetails:{\n              isShow:false,\n              url: '',\n            },\n            photoSlideshow:{\n              isShow:false,\n              url: '',\n            }\n          },\n        spanArr: [],\n        plans: [],\n        columns: [\"packageName\", \"specification1\", \"specification2\",\"specification3\",\"specification4\",\"specification5\"],\n      }\n    },\n    watch: {\n      option: function (){\n        console.log(\"option变化了\")\n        this.table_key = new Date().getTime();\n      },\n      'sales.levelFirstCategoryId': function (val) {\n        this.getCategory(val)\n      },\n      'sales.levelSecondCategoryId': function (val) {\n        this.sales.tags = []\n        this.referTags(this.levelFirstCategoryId, this.sales.levelFirstCategoryId);\n        this.referTags(this.levelSecondCategoryId, val);\n        console.log(this.tags)\n      },\n      'sales.extraService': function (val) {\n\n      },\n      'sales.totalPricesRate': function (val, oldVal) {\n        if (Number.parseFloat(val)>1.5){\n          this.$message.error(\"总价系数不能超过1.5\");\n          this.sales.totalPricesRate = oldVal;\n          return;\n        }\n      },\n      'sales.periodType': function (val) {\n        this.reset(\"type_1\",val);\n        // this.reset(\"type_2\",val);\n        this.reset(\"type_3\",val);\n      },\n    },\n    methods: {\n      changePackageName(val,row){\n        row.packageName = val;\n        console.log(val,row)\n      },\n      getchangeSpecification(name,data,val,row){\n        const newObj = Object.assign({},data)\n        newObj.lableName = name;\n        delete newObj.name\n        console.log(this.plans,val,row)\n        return Object.assign(newObj,val);\n      },\n      changeSpecification(data,val,row){\n        // const newObj = Object.assign({},data)\n        // newObj.lableName = newObj.name;\n        // delete newObj.name\n        // delete newObj.attr\n        // Object.assign(row,Object.assign(newObj,val))\n        // console.log(this.plans,val,row)\n      },\n      handler() {\n        const items = {};\n        const rentTypes = {}\n        this.usePlan = 0;\n        for (const type in this.sales.planInfo) {\n          const planInfo = this.sales.planInfo[type];\n          if (planInfo.rentType){\n            const defaults = this.$enum.defaultPlanInfo[type];\n            planInfo.name = defaults.typeName\n            rentTypes[defaults.typeName] = planInfo\n          }\n        }\n        this.specifications = []\n        for (let index  in  this.sales.specifications){\n          const  item = this.sales.specifications[index]\n          if (item.name&&item.name.length>0&&item.isGroup == true){\n            this.usePlan = this.usePlan+1;\n            for (const it of item.attr) {\n              items[it.name] = it\n            }\n            this.specifications.push(item)\n          }\n        }\n        var keys = Object.keys(items);\n\n        for (const plan of this.plans) {\n\n          var  packageName = plan.packageName;\n          packageName = this.sales.planInfo[\"type_\"+packageName.type];\n          if (rentTypes[packageName.name]){\n            plan.packageName = rentTypes[packageName.name]\n          }\n          if (packageName.rentRate){\n            plan.rentRate = packageName.rentRate\n          }\n          if (packageName.rentRate){\n            plan.rentRate = packageName.rentRate\n          }\n          if (packageName.lateFeeRate){\n            plan.lateFeeMoney = packageName.lateFeeRate\n          }\n          if (packageName.miniLease){\n            plan.miniLease = packageName.miniLease\n          }\n          if (packageName.buyoutBalancePayment){\n            plan.buyoutBalancePayment = packageName.buyoutBalancePayment\n          }\n\n          for (let i = 0; i < this.usePlan; i++) {\n            var value = plan['specification'+(i+1)];\n            if (value&&items[value.name]){\n              if(items[value.name].websitePrice){\n                plan.websitePrice = items[value.name].websitePrice\n                plan.renewalPrice = items[value.name].renewalPrice\n              }\n            }\n          }\n        }\n        console.log(this.sales.planInfo)\n        for (const planKey in this.sales.planInfo) {\n          console.log(this.sales.planInfo[planKey].rentRate)\n          if (func.toFloat(this.sales.planInfo[planKey].rentRate,1)>1){\n            this.sales.planInfo[planKey].rentRate = 1;\n            this.$message.error(\"租金系数设置失败，租金系数最大能超过1\")\n          }\n          if (func.toFloat(this.sales.planInfo[planKey].lateFeeRate,1)>1){\n            this.sales.planInfo[planKey].lateFeeRate = 1;\n            this.$message.error(\"日滞纳金系数设置失败，滞纳金系数最大能超过1\")\n          }\n        }\n        // console.log(JSON.stringify(this.sales))\n        // console.log(JSON.stringify(this.plans))\n        this.rowspan()\n      },\n      getMaxList(value,key){\n        if (!this.sales.periodType){\n          return [];\n        }\n        return value.maxLeaseList[this.sales.periodType-1][this.$enum.goodsPlanInfo.miniIndex(key,this.sales.periodType,this.sales.planInfo[key].miniLease)]\n      },\n      checkNumber(val){\n        return parseFloat(val).toString() != \"NaN\";\n      },\n      //每一期租金\n      calculateRentMoney(row){\n        const  data = Object.assign({totalPricesRate:this.sales.totalPricesRate},row);\n        var rentPerMoney = calculatePerRentMoney(data);\n        row.rentMoney = calculateRentMoney(data);\n        row.rentPerMoney = rentPerMoney;\n        // console.log(\"行数据\",row)\n        return rentPerMoney;\n      },\n      calculateBuyoutMoney(row){\n        const  data = Object.assign({totalPricesRate:this.sales.totalPricesRate},row);\n        return calculateBuyoutMoney(data)\n      },\n      calculateLateFeeMoney(row){\n        const  data = Object.assign({totalPricesRate:this.sales.totalPricesRate},row);\n        return calculateLateFeeMoney(data);\n      },\n      changeStockout(data){\n        var index = data.index\n        this.plans[index].stockout = false;\n        this.plans[index].$cellEdit = true;\n        this.table_key = new Date().getTime();\n      },\n      deleteRow(index){\n        var item = this.plans[index];\n        if (item.id){\n          this.sales.deleteCombination.push(item.id)\n        }\n        this.plans.splice(index, 1)\n      },\n      reset(key,val){\n        this.sales.planInfo[key].rentType=false\n        this.sales.planInfo[key].miniLease=null\n        this.sales.planInfo[key].miniType=val\n        this.sales.planInfo[key].maxLease=null\n        this.sales.planInfo[key].maxType=val\n      },\n      doCombination(arr) {\n        var count = arr.length - 1; //数组长度(从0开始)\n        var tmp = [];\n        var totalArr = [];// 总数组\n\n        return doCombinationCallback(arr, 0);//从第一个开始\n        //js 没有静态数据，为了避免和外部数据混淆，需要使用闭包的形式\n        function doCombinationCallback(arr, curr_index) {\n          for(const val of arr[curr_index]) {\n            tmp[curr_index] = val;//以curr_index为索引，加入数组\n            //当前循环下标小于数组总长度，则需要继续调用方法\n            if(curr_index < count) {\n              doCombinationCallback(arr, curr_index + 1);//继续调用\n            }else{\n              totalArr.push(tmp);//(直接给push进去，push进去的不是值，而是值的地址)\n            }\n            //js  对象都是 地址引用(引用关系)，每次都需要重新初始化，否则 totalArr的数据都会是最后一次的 tmp 数据；\n           var oldTmp = tmp;\n            tmp = [];\n            for(const index of oldTmp) {\n              tmp.push(index);\n            }\n          }\n          return totalArr;\n        }\n      },\n      addAttr(item){\n        item.attr.push({\n          name:null,\n          websitePrice:null,\n          renewalPrice:null,\n        })\n      },\n      deAttr(items,index){\n        this.$delete(items,index)\n      },\n      savePlan(){\n        const keys = [];\n        for (const plan of this.plans) {\n          let key = plan.packageName.name;\n          if (!plan.packageName.name||plan.packageName.name.length==0){\n            this.$message(\"保存失败,请选择方案\")\n            return;\n          }\n          for (let i = 0; i < this.usePlan; i++) {\n            const name = plan['specification'+(i+1)].name;\n            key = key+name;\n            if (!name||name.length==0){\n              this.$message.error(\"保存失败,请选择规格\")\n              return;\n            }\n          }\n          if (keys.indexOf(key) != -1){\n            this.$message.error(\"保存失败,当前组合已存在\")\n            return;\n          }\n          keys.push(key)\n        }\n\n        for (const plan of this.plans) {\n          plan.add = false;\n        }\n        this.$nextTick(_ => {\n          this.rowspan()\n          this.table_key = new Date().getTime();\n          this.handler()\n        });\n      },\n      addPlan(){\n        var item = {};\n        item.add = true;\n        item.websitePrice = 0\n        item.lateFeeMoney = 0\n        item.miniLease = 0\n        item.rentRate = 0\n        item.$cellEdit=true\n        item.buyoutBalancePayment = 0\n        item.rowKey = new Date().getTime();\n        item.packageName = {name:\"\"}\n\n        var number = 0;\n        for (let index in this.sales.specifications) {\n          var specification = this.sales.specifications[index]\n          if (specification.name&&specification.name.length>0&&specification.isGroup == true){\n            number = number+1;\n            item['specification'+number] = {index:index}\n          }\n        }\n        // for (let i = 0; i < this.usePlan; i++) {\n        //   item['specification'+(i+1)] = {}\n        // }\n        item.stockout = false\n        item.inventory = 0\n        item.premiumMoney = 0\n        item.depositMoney = 0\n        item.rentMoney = 0\n        item.buyoutMoney = 0\n        var data = {\n          \"packageName\": 1,\n          \"stockout\": 1,\n          \"inventory\": 1,\n          \"websitePrice\": 1,\n          \"premiumMoney\": 1,\n          \"rentRate\": 1,\n          \"depositMoney\": 1,\n          \"miniLease\": 1,\n          \"rentMoney\": 1,\n          \"buyoutMoney\": 1,\n          \"lateFeeMoney\": 1\n        };\n        for (let i = 0; i < this.usePlan; i++) {\n          data['specification'+(i+1)] = 1\n        }\n        this.spanArr.push(data)\n        console.log(item)\n        this.plans.push(item)\n      },\n      addCombination(){\n        this.sales.specifications.push({\n          name:null,\n          isGroup:false,\n          isUploadPhoto:false,\n          isSetPrice:false,\n          attr:[{\n            name:null,\n            websitePrice:null,\n            renewalPrice:null,\n          }],\n        })\n      },\n      deSpecification(items,index){\n        var item = items[index];\n        if (item.id){\n          this.sales.deleteSpecification.push(item.id)\n        }\n        this.$delete(items,index)\n      },\n      onSubmit() {\n        console.log('submit!');\n      },\n      handleClose(tag) {\n        this.sales.tags.splice(this.sales.tags.indexOf(tag), 1);\n      },\n\n      showInput() {\n        this.sales.inputVisible = true;\n        this.$nextTick(_ => {\n          this.$refs.saveTagInput.$refs.input.focus();\n        });\n      },\n\n      handleInputConfirm() {\n        let inputValue = this.sales.inputValue;\n        if (inputValue) {\n          this.sales.tags.push(inputValue);\n        }\n        this.sales.inputVisible = false;\n        this.sales.inputValue = '';\n      },\n      rowSave(form, done) {\n        this.$message.success(\n          '新增数据' + JSON.stringify(form)\n        )\n        done()\n      },\n      handleRowClick(row, column,event) {\n        if ((event.target&&event.target.className === 'el-switch__core')){\n          row.$cellEdit = !row.$cellEdit;\n          row.inventory = 0;\n        }\n      },\n      addUpdate(form, index, done, loading) {\n        this.$message.success('模拟网络请求')\n        setTimeout(() => {\n          this.$message.success('关闭按钮等待')\n          loading()\n        }, 1000)\n        setTimeout(() => {\n          this.$message.success(\n            '编辑数据' + JSON.stringify(form) + '数据序号' + index\n          )\n          done()\n        }, 2000)\n      },\n      rowspan() {\n        // this.spanArr = [[3,2,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]\n        this.spanArr.splice(0);\n        var proKeys = \"\";\n        this.plans.forEach((item, index) => {\n          var data = {\n            \"packageName\": 1,\n            \"stockout\": 1,\n            \"inventory\": 1,\n            \"websitePrice\": 1,\n            \"premiumMoney\": 1,\n            \"rentRate\": 1,\n            \"depositMoney\": 1,\n            \"miniLease\": 1,\n            \"rentMoney\": 1,\n            \"buyoutMoney\": 1,\n            \"lateFeeMoney\": 1\n          };\n          console.log(\"规格数量:\",this.usePlan)\n          for (let i = 0; i < this.usePlan; i++) {\n            data['specification'+(i+1)] = 1\n          }\n          this.spanArr.push(data)\n          Object.keys(item).forEach((second, index2) => {\n            if (this.columns.indexOf(second) != -1){\n              proKeys = proKeys + item[second].name;\n              // console.log(\"添加key\",proKeys)\n            }\n          })\n          // console.log(\"上一次的索引:\"+proKeys)\n          if (index > 0&&!item.add) {\n            var keys = \"\";\n            Object.keys(item).forEach((second, index2) => {\n              if (this.columns.indexOf(second) != -1) {\n                keys = keys + item[second].name;\n                // console.log(\"查看上一次的索引:\",proKeys)\n                // console.log(\"查看这一次的索引:\",keys)\n                // console.log(index,second,this.plans,this.plans[index - 1],this.plans[index][second])\n                // console.log(index,second,this.plans,this.plans[index - 1],this.plans[index - 1][second])\n                // console.log(\"匹配----------第\"+index+\"行,字段：\"+second+\"\",\"开头匹配\"+proKeys.startsWith(keys),\"是否合并\"+(this.data[index][second]===this.data[index-1][second]))\n                if (this.plans[index][second].name === this.plans[index - 1][second].name && proKeys.startsWith(keys)) {\n                  for (let i = index; i > 0; i--) {\n                    if (this.spanArr[i - 1][second] != 0) {\n                      this.spanArr[i - 1][second] += 1;\n                      break;\n                    }\n                  }\n                  this.spanArr[index][second] = 0;\n                } else {\n                  this.spanArr[index][second] = 1;\n                }\n              }\n            })\n            proKeys = keys;\n            // console.log(\"更新索引:\"+proKeys)\n          }\n        })\n      },\n      spanMethod({row, column, rowIndex, columnIndex}) {\n        let _row = this.spanArr[Number.parseInt(rowIndex)][column.property];\n        if (column.property == \"menu\"){\n          _row = 1;\n        }\n        const _col = _row > 0 ? 1 : 0;\n        return {\n          rowspan: _row,\n          colspan: _col\n        }\n      },\n      cellStyle({row, column, rowIndex, columnIndex}) {\n        if (column.property && (\n          column.property.startsWith(\"packageName\")\n          || column.property.startsWith(\"specification\")\n          || column.property.startsWith(\"websitePrice\")\n          || column.property.startsWith(\"miniLease\")\n          || column.property.startsWith(\"rentMoney\")\n          || column.property.startsWith(\"buyoutMoney\")\n          || column.property.startsWith(\"lateFeeMoney\")\n          || !row.$cellEdit)) {\n          return {\n            backgroundColor: '#FaFaFa',\n          }\n        }\n        if (column.property &&  column.property.startsWith(\"stockout\")) {\n          var txt = \"clip\";\n          return {\n            textOverflow:txt\n          }\n        }\n      },\n      headerClassName({row, column, rowIndex, columnIndex}) {\n        return \"head-class\"\n      },\n      cellClassName({row, column, rowIndex, columnIndex}) {\n        if (!row.$cellEdit&&column.property.startsWith(\"stockout\")){\n          return \"table-cell-class\"\n        }\n        return \"\"\n      },\n      handleRemove(file, fileList, type) {\n        this.sales[type] = this.sales[type].filter(item => {\n          console.log(item,file)\n          return item != file.name;\n        });\n        console.log(file.name)\n        console.log(JSON.stringify(this.photoCover),JSON.stringify(this.photoSlideshow))\n\n        this.photoSlideshow = this.photoSlideshow.filter(item => {\n          return item.name != file.name;\n        });\n\n        this.photoDetails = this.photoDetails.filter(item => {\n          return item.name != file.name;\n        });\n\n        this.photoCover = this.photoCover.filter(item => {\n          return item.name != file.name;\n        });\n\n        console.log(this.photoSlideshow,this.photoDetails,this.photoCover)\n      },\n      changePictureUpload(file,fileList){\n        this.uploadDisabled = fileList.length >= 1;\n      },\n      changeUpload(file,fileList, type){\n      },\n      onSuccessPhoto(res, file, type){\n        this.sales[type].push(res.data.name)\n      },\n      handlePictureCardPreview(file, type) {\n        console.log(file, type)\n        this.images[type].url = file.url;\n        this.images[type].isShow = true;\n      },\n      getDictionary(key) {\n        dictionary(key).then(res => {\n          if (key == \"network\")\n            this.newWorks = res.data.data\n          if (key == \"goods_hand\")\n            this.hands = res.data.data\n        });\n      },\n      getExtraService(key) {\n        dictionary(key).then(res => {\n          if (key == \"network\")\n            this.newWorks = res.data.data\n          if (key == \"goods_hand\")\n            this.hands = res.data.data\n        });\n      },\n      //获取分类\n      getCategory(parentId) {\n        if (parentId == 0) {\n          this.sales.levelFirstCategoryId = ''\n          this.levelSecondCategoryId = ''\n        } else {\n          this.sales.levelSecondCategoryId = ''\n        }\n        getList(0, 100, {parentId: parentId}).then(res => {\n          if (parentId == 0) {\n            this.levelFirstCategoryId = res.data.data\n          } else {\n            this.levelSecondCategoryId = res.data.data\n          }\n        })\n      },\n      referTags(data, select) {\n        for (let i = 0; i < data.length; i++) {\n          if (data[i].tags.length > 0 && data[i].id == select) {\n            Array.prototype.push.apply(this.sales.tags, data[i].tags.split(\",\"));\n          }\n        }\n      },\n      handlePreview(file) {\n        console.log(file);\n      },\n      // 保存，上架，下架，草稿\n      saveGoods(type){\n        if (type == -1){\n          this.$EventBus.$emit('tag', {\n            action:\"remove\",\n            value:\"/goods/add/index\",\n            isOpenTag:true,\n            isMatchAll:false\n          })\n          return;\n        }\n        // this.loading = true;\n        console.log(this.sales)\n\n\n\n        if (this.sales.planInfo.type_3&&Number.parseFloat(this.sales.planInfo.type_3.buyoutBalancePayment)<100){\n          Message({\n            message: \"买断尾款最少为100元\",\n            type: 'error'\n          })\n          return;\n        }\n\n        var data = JSON.stringify(this.sales);\n        console.log(data)\n        data = data.replace(/\\t|\\n|\\v|\\r|\\f/g,'').replace(/\\r\\n/g,'').replace(/\\n/g,'');\n        console.log(data)\n        let obj2 = JSON.parse(data)\n        var specifications = obj2.specifications;\n        obj2.specifications = [];\n        for (const specification of specifications) {\n          obj2.specifications.push(JSON.stringify(specification))\n        }\n        obj2.plans = [];\n        for (const plan of this.plans) {\n          obj2.plans.push(JSON.stringify(plan))\n        }\n        obj2.status = type;\n\n        console.log(obj2)\n\n        saveOrUpdate(obj2).then(response => {\n          this.loading = false;\n          this.$EventBus.$emit('tag', {\n            action:\"remove\",\n            value:\"/goods/add/index\",\n            isOpenTag:true,\n            isMatchAll:false\n          })\n        });\n      }\n    },\n    computed: {\n      isEdit(){\n        for (const plan of this.plans) {\n          if (plan.add){\n            return true;\n          }\n        }\n        return false;\n      },\n      headers(){\n        return headers()\n      },\n      option: function (){\n        var option = {\n          rowKey:'rowKey',\n          addBtn: false,\n          searchBtn: false,\n          border: true,\n          filterBtn: false,\n          refreshBtn: false,\n          columnBtn: false,\n          editBtn:false,\n          addRowBtn:false,\n          cellBtn:false,\n          cancelBtn:false,\n          headerAlign: 'center',\n          align: 'center',\n          menu:false,\n          column: []\n        }\n        option.column.push( {width: 100,label: '套餐',prop: 'packageName',cell: true,slot: true,})\n        var number = 0;\n        for (let index in this.sales.specifications) {\n          var item = this.sales.specifications[index]\n          if (item.name&&item.name.length>0&&item.isGroup == true){\n            option.column.push( { label: item.name, prop: 'specification'+(number+1), slot: true, cell: true })\n            number = number+1;\n          }\n        }\n        option.column.push( { label: '缺货', width: 60, prop: 'stockout', type: 'switch', cell: true })\n        option.column.push( { label: '库存(件)', width: 100, prop: 'inventory', cell: true, rules: [ { required: true, message: '请输入库存', trigger: 'blur' } ] })\n        option.column.push( { label: '官网价', width: 60, prop: 'websitePrice', slot: true, })\n        option.column.push( { label: '溢价金', prop: 'premiumMoney', cell: true, rules: [ { required: true, message: '请输入姓名', trigger: 'blur' } ] })\n        option.column.push( { label: '租金系数', prop: 'rentRate'})\n//        option.column.push( { label: '押金', prop: 'depositMoney', cell: true, rules: [ { required: true, message: '请输入姓名', trigger: 'blur' } ] })\n        option.column.push( { label: '最低月数', width: 70, prop: 'miniLease', slot: true, })\n        option.column.push( { label: '单期租金', width: 70, prop: 'rentMoney', slot: true, })\n        option.column.push( { label: '买断尾款', width: 70, prop: 'buyoutMoney', slot: true, })\n        option.column.push( { label: '滞纳金(日租金%)', width: 120, prop: 'lateFeeMoney', slot: true, })\n        option.column.push( { label: '操作', width: 100, prop: 'menu', slot: true, })\n        return option\n      },\n      cycleTotal: function () {\n        this.cycle01 = this.checkNum(this.cycle01, 1, 31)\n        this.cycle02 = this.checkNum(this.cycle02, 1, 31)\n        return this.cycle01 + '-' + this.cycle02;\n      },\n    },\n    mounted() {\n      const handler = ()=> this.handler()\n      Object.keys(this.sales)\n        .filter(_ => ![\"levelFirstCategoryId\", \"levelSecondCategoryId\", \"title\", \"marketing\",\"secondHand\",\"inputVisible\",\"inputValue\",\"photoDetails\",\"photoSlideshow\",\"photoCover\",\n          \"tags\",\"extraService\",\"marketingCornerMark\",\"returnAddressId\",\"leaseExplainId\",\"afterSaleId\"].includes(_)) // 排除对属性的监听\n        .forEach((_) => {\n          this.$watch(vm => vm.sales[_], handler, {\n            deep: true,\n            immediate: false\n          });\n        });\n      console.log(\"mounted-----\")\n    },\n    created() {\n      this.loading = true;\n      this.id=this.$route.query.goodsId;\n      this.getDictionary(\"network\")\n      this.getDictionary(\"goods_hand\")\n      this.$router.$avueRouter.setTitle(\"编辑商品\")\n      if (this.id == null){\n        this.$router.$avueRouter.setTitle(\"新增商品\")\n        //说明是新增\n        this.sales.periodType = this.$enum.goodsPlanInfo.defaultCycle\n        this.sales.billingCycle = this.$enum.goodsPlanInfo.billing_cycle_month\n        this.rowspan()\n        this.planInfos.type_1 = this.$enum.defaultPlanInfo.type_1\n        this.sales.planInfo.type_1.rentRate = this.planInfos.type_1.rentRate\n        this.sales.planInfo.type_1.typeTitle = this.planInfos.type_1.typeTitle\n        this.sales.planInfo.type_1.lateFeeRate = this.planInfos.type_1.lateFeeRate\n        this.sales.planInfo.type_1.renewalRate = this.planInfos.type_1.renewalRate\n\n        console.log(\"设置默认参数\")\n        // this.planInfos.type_2 = this.$enum.defaultPlanInfo.type_2\n        // this.sales.planInfo.type_2.rentRate = this.planInfos.type_2.rentRate\n        // this.sales.planInfo.type_2.lateFeeRate = this.planInfos.type_2.lateFeeRate\n\n        this.planInfos.type_3 = this.$enum.defaultPlanInfo.type_3\n        this.sales.planInfo.type_3.typeTitle = this.planInfos.type_3.typeTitle\n        this.sales.planInfo.type_3.rentRate = this.planInfos.type_3.rentRate\n        this.sales.planInfo.type_3.lateFeeRate = this.planInfos.type_3.lateFeeRate\n\n        this.sales.totalPricesRate = this.$enum.goodsPlanInfo.defaultTotalPricesRate\n      }\n      this.getCategory(0)\n      getExtraserviceList(0, 100, {}).then(res => {\n        this.extraServices = res.data.data.records\n      })\n      getReturnAddressList(0, 100, {}).then(res => {\n        this.returnAddresses = res.data.data.records\n      })\n      getMaintaininfoList().then(res => {\n        this.mainTainInfos = res.data.data\n      })\n      getRentinfoList().then(res => {\n        this.rentinfos = res.data.data\n      })\n      console.log(this.sales.planInfo)\n\n      if (this.id != null){\n        console.log(\"-----\")\n        //说明是新增\n        getDetail(this.id).then(res => {\n          this.loading = false;\n          var goodsInfo = res.data.data;\n          goodsInfo.specifications = [];\n          try {\n            var obj = JSON.parse(goodsInfo.goodsSpecificationsJsonData);\n            if(typeof obj == 'object' && obj ){\n              goodsInfo.specifications = obj\n            }\n          }catch (e) {\n\n          }\n\n          var tags = goodsInfo.tags;\n          if (goodsInfo.photoCover)\n            this.sales.photoCover = goodsInfo.photoCover.split(\",\");\n          if (goodsInfo.photoDetails)\n            this.sales.photoDetails = goodsInfo.photoDetails.split(\",\");\n          if (goodsInfo.photoSlideshow)\n            this.sales.photoSlideshow = goodsInfo.photoSlideshow.split(\",\");\n          for (const photo of this.sales.photoCover) {\n            this.photoCover.push({name: photo, url: this.$store.state.common.cloudDomain+photo})\n          }\n          for (const photo of this.sales.photoDetails) {\n            this.photoDetails.push({name: photo, url: this.$store.state.common.cloudDomain+photo})\n          }\n          for (const photo of this.sales.photoSlideshow) {\n            this.photoSlideshow.push({name: photo, url: this.$store.state.common.cloudDomain+photo})\n          }\n\n          this.sales.levelFirstCategoryId = goodsInfo.levelFirstCategoryId;\n          this.getCategory(this.sales.levelFirstCategoryId)\n          this.$nextTick(() => {\n            // DOM更新了\n            this.sales.levelSecondCategoryId = goodsInfo.levelSecondCategoryId;\n            this.$nextTick(() => {\n              this.sales.tags = []\n              this.sales.tags = goodsInfo.category.split(\",\");\n            })\n\n          })\n          this.sales.id = goodsInfo.id;\n          this.sales.limitUser = goodsInfo.limitUser;\n          this.sales.title = goodsInfo.title;\n          this.sales.marketing = goodsInfo.marketing;\n          this.sales.oldNew = goodsInfo.secondHand == 100?\"0\":\"1\";\n          this.sales.secondHand = goodsInfo.secondHand;\n          this.sales.marketingCornerMark = goodsInfo.marketingCornerMark;\n          this.sales.extraService = goodsInfo.extraService.split(\",\")\n          this.sales.returnAddressId = goodsInfo.returnAddressId;\n          this.sales.expressFree = goodsInfo.expressFree;\n          this.sales.expressPrice = goodsInfo.expressPrice\n          this.sales.leaseExplainId = Number.parseInt(goodsInfo.leaseExplainId);\n          this.sales.afterSaleId = Number.parseInt(goodsInfo.afterSaleId);\n          this.sales.periodType = goodsInfo.periodType+\"\";\n          this.sales.billingCycle = goodsInfo.billingCycle;\n          this.sales.totalPricesRate = goodsInfo.totalPricesRate;\n          this.sales.specifications = goodsInfo.specifications\n          this.$nextTick(() => {\n            if(goodsInfo.planInfo.type_1){\n              goodsInfo.planInfo.type_1.rentType = true;\n              Object.assign(this.sales.planInfo.type_1,goodsInfo.planInfo.type_1)\n              this.sales.planInfo.type_1.rentType = true;\n            }else{\n              this.sales.planInfo.type_1.rentType = false;\n            }\n            this.sales.planInfo.type_1.lateFeeRate = 0.2;\n            // if(goodsInfo.planInfo.type_2){\n            //   Object.assign(this.sales.planInfo.type_2,goodsInfo.planInfo.type_2)\n            //   this.sales.planInfo.type_2.rentType = true;\n            // }else{\n            //   this.sales.planInfo.type_2.rentType = false;\n            // }\n            if(goodsInfo.planInfo.type_3){\n              Object.assign(this.sales.planInfo.type_3,goodsInfo.planInfo.type_3)\n              this.sales.planInfo.type_3.rentType = true;\n            }else{\n              this.sales.planInfo.type_3.rentType = false;\n            }\n            this.sales.planInfo.type_3.lateFeeRate = 0.2;\n            console.log(\"赋值\",this.plans)\n          })\n          this.plans = JSON.parse(goodsInfo.combinationsJsonData)\n          //更新下拉\n          this.rowspan()\n          this.table_key = new Date().getTime();\n        });\n      }else{\n        this.loading = false;\n      }\n    }\n  };\n</script>\n\n<style scoped=\"scoped\" lang=\"scss\">\n  .top-bar-title {\n    height: 30px;\n    background-color: white;\n    padding: 10px 20px 10px 20px;\n    margin-left: 6px;\n    margin-right: 6px;\n    display: flex;\n    justify-content: space-between;\n    border-bottom: 2px solid #F0F2F5;\n  }\n\n  .basis-info {\n    margin-top: 10px;\n    margin-left: 6px;\n    margin-right: 6px;\n  }\n\n  .basis-info .text {\n    font-size: 14px;\n  }\n\n  .basis-info .item {\n    margin-bottom: 18px;\n  }\n\n  :deep .el-card__header {\n    padding: 18px 20px !important;\n  }\n\n  .basis-info .clearfix:before,\n  .basis-info .clearfix:after {\n    display: table;\n    content: \"\";\n  }\n\n  .basis-info .clearfix:after {\n    clear: both\n  }\n\n  .form-view :deep .el-select {\n    width: 100%;\n  }\n\n  .form-view .el-tag + .el-tag {\n    margin-left: 10px;\n  }\n\n  .form-view .button-new-tag {\n    margin-left: 10px;\n    height: 32px;\n    line-height: 30px;\n    padding-top: 0;\n    padding-bottom: 0;\n  }\n\n  .form-view .input-new-tag {\n    width: 90px;\n    margin-left: 10px;\n    vertical-align: bottom;\n  }\n\n  .has-background {\n    width: calc(100% - 20px);\n    background-color: #F2F2F260;\n  }\n\n  .has-background-item {\n    margin: 20px 10px 20px 10px;\n    display: block;\n  }\n\n  .no-background {\n    width: calc(100% - 20px);\n    padding: 5px 10px 5px 10px;\n  }\n\n  .form-input-3 {\n    width: 150px\n  }\n\n  .form-input-title {\n    margin-left: 20px;\n    margin-right: 10px\n  }\n\n  .form-select-2 {\n    width: 330px !important;\n  }\n\n  .form-plan-notice {\n    margin-left: 10px;\n    color: #D9001B\n  }\n\n  :deep .avue-crud__menu {\n    display: none;\n  }\n\n  :deep .head-class {\n    background-color: white !important;\n  }\n\n  .top {\n    position: fixed;\n    top: 110px;\n    z-index: 11;\n    width: calc(100% - 293px);\n  }\n\n  .small :deep .el-upload--picture-card {\n    width: 80px;\n    height: 80px;\n    line-height: 80px;\n   }\n  .small :deep .el-upload-list--picture-card .el-upload-list__item {\n    width: 80px;\n    height: 80px;\n  }\n  .disabled {\n    ::v-deep .el-upload--picture-card {\n      display: none;\n    }\n  }\n\n  :deep .el-empty {\n    padding: 0px 0px !important;\n  }\n  :deep .avue-crud__empty {\n    padding: 0px 0px !important;\n  }\n\n  ::v-deep .table-cell-class div {\n    text-overflow: clip !important;\n  }\n\n  ::v-deep  .hide  .el-upload--picture-card {\n\n      display: none !important;\n\n    }\n\n\n  //去掉过渡动画，不然删除操作的时候，布局会闪一下。\n\n  ::v-deep .el-upload-list__item {\n\n    transition: none !important\n\n  }\n</style>\n"]}]}